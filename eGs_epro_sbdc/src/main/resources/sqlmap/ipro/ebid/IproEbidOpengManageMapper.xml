<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!--
 * 개찰관리 > 개찰관리 Mapper
 *
 * <pre>
 * sqlmap.oda.iep.elbi 
 *    |_ IepElbiPrdprcManageMapper.xml
 * 
 * </pre>
 * @date : 2015. 02. 27. 오후 08:33:33
 * @version : 1.0
 * @author : 은우소프트 하성윤
-->
<mapper namespace="com.eunwoosoft.ipro.ebid.dao.IproEbidOpengManageDao">	
	<!--  
     * <pre>
     * 1. 개요 : 개찰관리 목록조회_페이징 
     * 2. 처리내용 :
     *  	TABLE : T_BI_MST(입찰계획마스터)
     					,T_BI_ROUND(입찰시간정보)
     * </pre>
     * @Query ID : selectOpengManageListWithPgng
     * @date : 2015. 02. 27.
     * @author : 은우소프트 하성윤
     * @history : 
     *  =======================================================
     *  변경일             		작성자                     		변경내용  
     *  =======================================================
     *  2015. 02. 27.       은우소프트 하성윤              최초 작성 
     *  =======================================================   
     -->
	<select id="selectOpengManageListWithPgng" resultType="dataEntity">
		<include refid="ComPgng.pgngHeaderClause"/>
		SELECT * FROM (
			<include refid="opengManageList"/>
			<include refid="opengManageWhere"/>
			ORDER BY BIDC_SBMT_ENDT DESC, ANNC_NO DESC, ANNC_NGR DESC
		) T1
		WHERE 1 = 1
		<include refid="ComPgng.pgngTailClause"/>
	</select>
	
	<!--  
     * <pre>
     * 1. 개요 : 개찰관리 목록총건수조회 
     * 2. 처리내용 :
     *  	TABLE : T_BI_MST(입찰계획마스터)
     					,T_BI_ROUND(입찰시간정보)
     * </pre>
     * @Query ID : selectOpengManageListTotcnt
     * @date : 2015. 02. 27.
     * @author : 은우소프트 하성윤
     * @history : 
     *  =======================================================
     *  변경일             		작성자                     		변경내용  
     *  =======================================================
     *  2015. 02. 27.       은우소프트 하성윤              최초 작성 
     *  =======================================================   
     -->
	<select id="selectOpengManageListTotcnt" resultType="int">
		SELECT COUNT(1) FROM (
			<include refid="opengManageList"/>
			<include refid="opengManageWhere"/>
		) T1
		WHERE 1 = 1		
	</select>
	
	<sql id="opengManageList">
    SELECT	*
       FROM (
           SELECT A.ANNC_NO
                     , A.ANNC_NGR
                     , B.ROUND_NO
                     , A.APPR_STCD
                     , F_CDVAL_INQIRE('APPR_STCD', A.APPR_STCD) AS APPR_STCD_NM
                     , A.CONT_SECD
                     , F_CDVAL_INQIRE('CONT_SECD', A.CONT_SECD) AS CONT_SECD_NM
                     , A.BID_NM
                     , A.SBID_MTCD
                     , F_CDVAL_INQIRE('SBID_MTCD', A.SBID_MTCD) AS SBID_MTCD_NM
                     , B.BIDC_SBMT_ENDT
                     , A.EMRG_YN
                     , ( SELECT COUNT(*)
                            FROM T_BI_VEND_MST C
                         WHERE C.ANNC_NO = A.ANNC_NO
                              AND C.ANNC_NGR = A.ANNC_NGR
                              AND C.ROUND_NO = B.ROUND_NO
                              AND BID_VEND_PSCD = 'OP04' ) AS VEND_CNT
                     , A.CHRGR_NM
                     , A.CHRGR_ID
                     , ( SELECT COUNT(*)
                            FROM T_BI_VEND_MST VM
                         WHERE B.ANNC_NO  = VM.ANNC_NO
                             AND B.ANNC_NGR = VM.ANNC_NGR
                             AND B.ROUND_NO = VM.ROUND_NO ) AS OPEN_CNT
              FROM T_BI_MST A
                     , T_BI_ROUND B
			WHERE	1=1
			AND		A.ANNC_NGR = ( SELECT MAX(ANNC_NGR) FROM T_BI_MST WHERE ANNC_NO = A.ANNC_NO )
			AND		A.ANNC_NO = B.ANNC_NO
			AND		A.ANNC_NGR = B.ANNC_NGR
			AND		NVL(A.DEL_AT, 'N') != 'Y'
			AND		B.BIDC_SBMT_ENDT &lt; TO_CHAR(SYSDATE, 'yyyyMMddhh24miss')
			AND		A.BID_PSCD IN ('PF20', 'PF30')
			AND		A.BID_MTCD IN ('BID', 'OFF')
			AND		B.ROUND_NO = ( SELECT MAX(ROUND_NO) FROM T_BI_ROUND WHERE ANNC_NO = A.ANNC_NO AND ANNC_NGR = A.ANNC_NGR )
					)
	</sql>
	
	<sql id="opengManageWhere">
		<where>
		<if test='P_BID_NM_S != null and P_BID_NM_S != "" '>
			AND BID_NM LIKE '%'||#{P_BID_NM_S}||'%'
		</if>
		<if test='P_ANNC_NO_S != null and P_ANNC_NO_S != "" '>
			AND ANNC_NO LIKE '%'||#{P_ANNC_NO_S}||'%'
		</if>
		<if test='P_APPR_STCD_S != null and P_APPR_STCD_S != "" '>
			AND APPR_STCD = #{P_APPR_STCD_S}
		</if>
		<if test='P_CONT_SECD_S != null and P_CONT_SECD_S != "" '>
			AND CONT_SECD = #{P_CONT_SECD_S}
		</if>
		<if test='P_SBID_MTCD_S != null and P_SBID_MTCD_S != "" '>
			AND SBID_MTCD = #{P_SBID_MTCD_S}
		</if>
		<if test='P_BIDC_SBMT_ENDT_STDE_S != null and P_BIDC_SBMT_ENDT_STDE_S != "" '>
			AND TO_CHAR(TO_DATE(BIDC_SBMT_ENDT, 'yyyyMMddhh24miss'), 'yyyyMMdd') >= #{P_BIDC_SBMT_ENDT_STDE_S}
		</if>
		<if test='P_BIDC_SBMT_ENDT_ENDE_S != null and P_BIDC_SBMT_ENDT_ENDE_S != "" '>
			AND TO_CHAR(TO_DATE(BIDC_SBMT_ENDT, 'yyyyMMddhh24miss'), 'yyyyMMdd') &lt;= #{P_BIDC_SBMT_ENDT_ENDE_S}
		</if>
		<if test='P_CHRGR_ID_S != null and P_CHRGR_ID_S != "" '>
			AND CHRGR_ID = #{P_CHRGR_ID_S}
		</if>
		</where>
	</sql>
	
	
	<!--  
     * <pre>
     * 1. 개요 : 예가 금액 수정
     * 2. 처리내용 :
     *  	TABLE : T_BI_ESTC_MST(예가등록)
     * </pre>
     * @Query ID : updatePrdprcAmountUpdt
     * @date : 2015. 03. 24.
     * @author : 은우소프트 하성윤
     * @history : 
     *  =======================================================
     *  변경일             		작성자                     		변경내용  
     *  =======================================================
     *  2015. 03. 24.       은우소프트 하성윤              최초 작성 
     *  =======================================================   
     -->
	<update id="updatePrdprcAmountUpdt">
			UPDATE	T_BI_ESTC_MST
			SET		SCH_PRCE_AMT = #{P_SCH_PRCE_AMT , jdbcType=INTEGER}
						,MOD_DT = TO_CHAR(SYSDATE, 'yyyyMMddHH24MISS')
						<include refid="ComRegr.ModrSetClause"/>
			WHERE	ANNC_NO = #{P_ANNC_NO , jdbcType=VARCHAR}
			AND		ANNC_NGR = #{P_ANNC_NGR , jdbcType=INTEGER}
			AND		ROUND_NO = #{P_ROUND_NO , jdbcType=INTEGER}
	</update>
	
	<!--  
     * <pre>
     * 1. 개요 : 복수 예가 금액 수정
     * 2. 처리내용 :
     *  	TABLE : T_BI_PLRL_ESTC(복수예가)
     * </pre>
     * @Query ID : updateCompnoPrdprcAmountUpdt
     * @date : 2015. 03. 24.
     * @author : 은우소프트 하성윤
     * @history : 
     *  =======================================================
     *  변경일             		작성자                     		변경내용  
     *  =======================================================
     *  2015. 03. 24.       은우소프트 하성윤              최초 작성 
     *  =======================================================   
     -->
	<update id="updateCompnoPrdprcAmountUpdt">
			UPDATE	T_BI_PLRL_ESTC
			SET		PREP_PRCE_AMT = #{P_PREP_PRCE_AMT , jdbcType=INTEGER}
						,MOD_DT = TO_CHAR(SYSDATE, 'yyyyMMddHH24MISS')
						<include refid="ComRegr.ModrSetClause"/>
			WHERE	ANNC_NO = #{P_ANNC_NO , jdbcType=VARCHAR}
			AND		ANNC_NGR = #{P_ANNC_NGR , jdbcType=INTEGER}
			AND		ROUND_NO = #{P_ROUND_NO , jdbcType=INTEGER}
			AND		PLR_ESTPC_NO = #{P_PLR_ESTPC_NO , jdbcType=INTEGER}
	</update>
	
	
	<!--  
     * <pre>
     * 1. 개요 : 참여 업체 정보 조회
     * 2. 처리내용 :
     *  	TABLE : T_BI_VEND_MST(업체참여마스터)
     					,T_BI_VEND_DTL(업체참여상세)
     * </pre>
     * @Query ID : selectPartcptnEntrpsInfoInqire
     * @date : 2015. 03. 24.
     * @author : 은우소프트 하성윤
     * @history : 
     *  =======================================================
     *  변경일             		작성자                     		변경내용  
     *  =======================================================
     *  2015. 03. 24.       은우소프트 하성윤              최초 작성 
     *  =======================================================   
     -->
	<select id="selectPartcptnEntrpsInfoInqire" resultType="dataEntity">
			SELECT	A.ANNC_NO
						, A.ANNC_NGR
						, A.ROUND_NO
						, A.VEND_REG_NO
						, A.TNDR_AMT
						, A.TNDR_AMT_ENC
						, A.SSN_VKEY
						, A.BID_VEND_PSCD
						, A.ESTM_SCR
						, B.BID_TPI_SECD
			<if test='reload == "Y" '>
						, CASE WHEN C.SBID_LWST_RT &lt; ROUND((A.TNDR_AMT/D.ESTPC_AMT)* 100,2) THEN 'Y' ELSE 'N' END AS SCSBID_LWLT_AT
			</if>
			FROM		T_BI_VEND_MST A
						, T_BI_VEND_DTL B
			<if test='reload == "Y" '>
						, T_BI_MST C
						, T_BI_ESTC_MST D
			</if>
			WHERE	A.ANNC_NO = B.ANNC_NO
			AND		A.ANNC_NGR = B.ANNC_NGR
			AND		A.ROUND_NO = B.ROUND_NO
			AND		A.VEND_REG_NO = B.VEND_REG_NO
			<if test='reload == "Y" '>
			AND		A.ANNC_NO = C.ANNC_NO
			AND		A.ANNC_NGR = C.ANNC_NGR
			AND		A.ANNC_NO = D.ANNC_NO
			AND		A.ANNC_NGR = D.ANNC_NGR
			AND		A.ROUND_NO = D.ROUND_NO
			</if>
			<if test='P_BID_VEND_PSCD_LIST != null and P_BID_VEND_PSCD_LIST.size != 0 '>
				AND	A.BID_VEND_PSCD IN
				<foreach separator="," item="bid_vend_pscd" collection="P_BID_VEND_PSCD_LIST" open="(" close=")">
				#{bid_vend_pscd, jdbcType=VARCHAR}
				</foreach>				
			</if>
			<if test='P_BID_VEND_PSCD_LIST == null'>
			AND		A.BID_VEND_PSCD = 'OP04'
			</if>						
			AND		B.BID_TPI_SECD = 'OP03'
			AND		A.ANNC_NO = #{P_ANNC_NO , jdbcType=VARCHAR}
			AND		A.ANNC_NGR = #{P_ANNC_NGR , jdbcType=INTEGER}
			AND		A.ROUND_NO = #{P_ROUND_NO , jdbcType=INTEGER}
	</select>
	
	<!--  
     * <pre>
     * 1. 개요 : 기술평가 완료 여부 조회
     * 2. 처리내용 :
     *  	TABLE : TEBI_TEEVPL(기술평가계획)
     * </pre>
     * @Query ID : selectTchqvlnComptAtInqire
     * @date : 2015. 03. 24.
     * @author : 은우소프트 하성윤
     * @history : 
     *  =======================================================
     *  변경일             		작성자                     		변경내용  
     *  =======================================================
     *  2015. 03. 24.       은우소프트 하성윤              최초 작성 
     *  =======================================================   
     -->
	<select id="selectTchqvlnComptAtInqire" resultType="dataEntity">
			SELECT	ANNC_NO
						,ANNC_NGR
						,ROUND_NO
						,VEND_REG_NO
						,ESTM_SCR
			FROM		T_BI_VEND_MST
			WHERE	BID_VEND_PSCD = 'OP04'
			AND		ESTM_ELCD IS NOT NULL
			AND		ANNC_NO = #{P_ANNC_NO , jdbcType=VARCHAR}
			AND		ANNC_NGR = #{P_ANNC_NGR , jdbcType=INTEGER}
			AND		ROUND_NO = #{P_ROUND_NO , jdbcType=INTEGER}
			
	</select>
	
	<!--  
     * <pre>
     * 1. 개요 : 미 투찰 업체 조회
     * 2. 처리내용 :
     *  	TABLE : T_BI_MST(입찰계획마스터)
     * </pre>
     * @Query ID : selectUnBddprEntrpsInqire
     * @date : 2015. 03. 30.
     * @author : 은우소프트 하성윤
     * @history : 
     *  =======================================================
     *  변경일             		작성자                     		변경내용  
     *  =======================================================
     *  2015. 03. 30.       은우소프트 하성윤              최초 작성 
     *  =======================================================   
     -->
	<select id="selectUnBddprEntrpsInqire" resultType="dataEntity">
			SELECT	VEND_REG_NO
			FROM		T_BI_VEND_MST
			WHERE	TNDR_AMT_ENC IS NULL
			AND		ANNC_NO = #{P_ANNC_NO , jdbcType=VARCHAR}
			AND		ANNC_NGR = #{P_ANNC_NGR , jdbcType=INTEGER}
			AND		ROUND_NO = #{P_ANNC_NGR , jdbcType=INTEGER}
	</select>
	
	<!--  
     * <pre>
     * 1. 개요 : 투찰 품목 목록 조회
     * 2. 처리내용 :
     *  	TABLE : T_BI_TNDR_ITEM(투찰품목)
     * </pre>
     * @Query ID : selectBddprPrdlstListInqire
     * @date : 2015. 03. 25.
     * @author : 은우소프트 하성윤
     * @history : 
     *  =======================================================
     *  변경일             		작성자                     		변경내용  
     *  =======================================================
     *  2015. 03. 25.       은우소프트 하성윤              최초 작성 
     *  =======================================================   
     -->
	<select id="selectBddprPrdlstListInqire" resultType="dataEntity">
			SELECT	ANNC_NO
						,ANNC_NGR
						,ROUND_NO
						,ITEM_SN
						,VEND_REG_NO
						,ITEM_UNIT_AMT
						,ITEM_UNIT_ENC
						,SSN_VKEY
			FROM		T_BI_TNDR_ITEM
			WHERE	ANNC_NO = #{P_ANNC_NO , jdbcType=VARCHAR}
			AND		ANNC_NGR = #{P_ANNC_NGR , jdbcType=INTEGER}
			AND		ROUND_NO = #{P_ROUND_NO , jdbcType=INTEGER}
			AND		VEND_REG_NO = #{P_VEND_REG_NO , jdbcType=VARCHAR}
	</select>
	
	<!--  
     * <pre>
     * 1. 개요 : 복호화 투찰금액 저장
     * 2. 처리내용 :
     *  	TABLE : T_BI_VEND_MST(업체참여마스터)
     * </pre>
     * @Query ID : updateDecdBddprAmountStre
     * @date : 2015. 03. 25.
     * @author : 은우소프트 하성윤
     * @history : 
     *  =======================================================
     *  변경일             		작성자                     		변경내용  
     *  =======================================================
     *  2015. 03. 25.       은우소프트 하성윤              최초 작성 
     *  =======================================================   
     -->
	<update id="updateDecdBddprAmountStre" >
			UPDATE	T_BI_VEND_MST
			SET		TNDR_AMT = #{P_TNDR_AMT , jdbcType=INTEGER}
						,MOD_DT = TO_CHAR(SYSDATE, 'yyyyMMddHH24MISS')
						<include refid="ComRegr.ModrSetClause"/>
			WHERE	ANNC_NO = #{P_ANNC_NO , jdbcType=VARCHAR}
			AND		ANNC_NGR = #{P_ANNC_NGR , jdbcType=INTEGER}
			AND		ROUND_NO = #{P_ROUND_NO , jdbcType=INTEGER}
			AND		VEND_REG_NO = #{P_VEND_REG_NO , jdbcType=VARCHAR}
	</update>
	
	<!--  
     * <pre>
     * 1. 개요 : 복호화 품목 단가 저장
     * 2. 처리내용 :
     *  	TABLE : T_BI_TNDR_ITEM(투찰품목)
     * </pre>
     * @Query ID : updateDecdPrdlstUntpcAmountStre
     * @date : 2015. 03. 25.
     * @author : 은우소프트 하성윤
     * @history : 
     *  =======================================================
     *  변경일             		작성자                     		변경내용  
     *  =======================================================
     *  2015. 03. 25.       은우소프트 하성윤              최초 작성 
     *  =======================================================   
     -->
	<update id="updateDecdPrdlstUntpcAmountStre" >
			UPDATE	T_BI_TNDR_ITEM
			SET		ITEM_UNIT_AMT = #{P_ITEM_UNIT_AMT , jdbcType=INTEGER}
						,MOD_DT = TO_CHAR(SYSDATE, 'yyyyMMddHH24MISS')
						<include refid="ComRegr.ModrSetClause"/>
			WHERE	ANNC_NO = #{P_ANNC_NO , jdbcType=VARCHAR}
			AND		ANNC_NGR = #{P_ANNC_NGR , jdbcType=INTEGER}
			AND		ROUND_NO = #{P_ROUND_NO , jdbcType=INTEGER}
			AND		VEND_REG_NO = #{P_VEND_REG_NO , jdbcType=VARCHAR}
			AND		ITEM_SN = #{P_ITEM_SN , jdbcType=VARCHAR}
	</update>
	
	<!--  
     * <pre>
     * 1. 개요 : 추첨 복수예가 저장
     * 2. 처리내용 :
     *  	TABLE : T_BI_PLRL_ESTC(복수예가)
     * </pre>
     * @Query ID : updateDrwtCompnoPrdprcStre
     * @date : 2015. 03. 25.
     * @author : 은우소프트 하성윤
     * @history : 
     *  =======================================================
     *  변경일             		작성자                     		변경내용  
     *  =======================================================
     *  2015. 03. 25.       은우소프트 하성윤              최초 작성 
     *  =======================================================   
     -->
	<update id="updateDrwtCompnoPrdprcStre" >
			UPDATE	T_BI_PLRL_ESTC A
			SET		DRLT_CNT = CASE WHEN #{P_IN_YN} = 'Y' THEN	NVL((SELECT		COUNT( PLR_ESTPC_NO )
																											FROM		T_BI_VEND_MST D
																															,T_BI_VEND_ESSE C
																											WHERE		D.ANNC_NO = C.ANNC_NO
																											AND			D.ANNC_NGR = C.ANNC_NGR
																											AND			D.ROUND_NO = C.ROUND_NO
																											AND			D.VEND_REG_NO = C.VEND_REG_NO
																											AND			NVL(D.BID_ABND_YN,'N') = 'N' 
																											AND			NVL(D.ESTM_ELCD,'ELGB') = 'ELGB'
																											AND			C.ANNC_NO = A.ANNC_NO
																											AND			C.ANNC_NGR = A.ANNC_NGR
																											AND			C.ROUND_NO = A.ROUND_NO
																											AND			C.PLR_ESTPC_NO = A.PLR_ESTPC_NO) , 0 )
													ELSE NVL((SELECT		COUNT( PLR_ESTPC_NO )
																	FROM		T_BI_VEND_MST D
																					,T_BI_VEND_ESSE C
																	WHERE		D.ANNC_NO = C.ANNC_NO
																	AND			D.ANNC_NGR = C.ANNC_NGR
																	AND			D.ROUND_NO = C.ROUND_NO
																	AND			D.VEND_REG_NO = C.VEND_REG_NO
																	AND			NVL(D.BID_ABND_YN,'N') = 'N'
																	AND			NVL(D.BID_ELCD,'ELGB') = 'ELGB'
																	AND			NVL(D.ESTM_ELCD,'ELGB') = 'ELGB'
																	AND			C.ANNC_NO = A.ANNC_NO
																	AND			C.ANNC_NGR = A.ANNC_NGR
																	AND			C.ROUND_NO = A.ROUND_NO
																	AND			C.PLR_ESTPC_NO = A.PLR_ESTPC_NO) , 0 ) END
						,MOD_DT = TO_CHAR(SYSDATE, 'yyyyMMddHH24MISS')
						<include refid="ComRegr.ModrSetClause"/>
			WHERE	ANNC_NO = #{P_ANNC_NO , jdbcType=VARCHAR}
			AND		ANNC_NGR = #{P_ANNC_NGR , jdbcType=INTEGER}
			AND		ROUND_NO = #{P_ROUND_NO , jdbcType=INTEGER}
	</update>
	
	<!--  
     * <pre>
     * 1. 개요 : 복수예가 선택 저장
     * 2. 처리내용 :
     *  	TABLE : T_BI_PLRL_ESTC(복수예가)
     * </pre>
     * @Query ID : updateCompnoPrdprcChoiseStre
     * @date : 2015. 03. 25.
     * @author : 은우소프트 하성윤
     * @history : 
     *  =======================================================
     *  변경일             		작성자                     		변경내용  
     *  =======================================================
     *  2015. 03. 25.       은우소프트 하성윤              최초 작성 
     *  =======================================================   
     -->
	<update id="updateCompnoPrdprcChoiseStre" >
			UPDATE	T_BI_PLRL_ESTC
			SET 		SLCT_YN = 'Y'
						,MOD_DT = TO_CHAR(SYSDATE, 'yyyyMMddHH24MISS')
						<include refid="ComRegr.ModrSetClause"/>
			WHERE 	PLR_ESTPC_NO IN
							(	SELECT PLR_ESTPC_NO
								FROM (
									SELECT	PLR_ESTPC_NO
									FROM		T_BI_PLRL_ESTC
									WHERE	ANNC_NO = #{P_ANNC_NO , jdbcType=VARCHAR}
									AND		ANNC_NGR = #{P_ANNC_NGR , jdbcType=INTEGER}
									AND		ROUND_NO = #{P_ROUND_NO , jdbcType=INTEGER}
									ORDER BY DRLT_CNT DESC, PLR_ESTPC_NO ASC
								)
								WHERE	ROWNUM &lt;= #{P_DRPR_REPR}
			                )
			    AND  ANNC_NO = #{P_ANNC_NO , jdbcType=VARCHAR}
				AND	ANNC_NGR = #{P_ANNC_NGR , jdbcType=INTEGER}
				AND	ROUND_NO = #{P_ROUND_NO , jdbcType=INTEGER}
	</update>
	
	<!--  
     * <pre>
     * 1. 개요 : 예정가격 금액 저장
     * 2. 처리내용 :
     *  	TABLE : T_BI_ESTC_MST(단일예가)
     * </pre>
     * @Query ID : updatePrearngePcAmountStre
     * @date : 2015. 03. 25.
     * @author : 은우소프트 하성윤
     * @history : 
     *  =======================================================
     *  변경일             		작성자                     		변경내용  
     *  =======================================================
     *  2015. 03. 25.       은우소프트 하성윤              최초 작성 
     *  =======================================================   
     -->
	<update id="updatePrearngePcAmountStre" >
			UPDATE 	T_BI_ESTC_MST D
			SET		SCH_PRCE_AMT = TRUNC( (	SELECT	SUM(PREP_PRCE_AMT) AS MOK
																FROM	  	T_BI_MST A
																			, T_BI_PLRL_ESTC C
																WHERE	A.ANNC_NO		= D.ANNC_NO
																AND		A.ANNC_NGR		= D.ANNC_NGR
																AND		D.ANNC_NO		= C.ANNC_NO
																AND		D.ANNC_NGR		= C.ANNC_NGR
																AND		D.ROUND_NO		= C.ROUND_NO
																AND		A.ESTPC_SECD	= '180000'
																AND		C.SLCT_YN 	= 'Y'
															) / #{P_DRPR_REPR} )
						,MOD_DT = TO_CHAR(SYSDATE, 'yyyyMMddHH24MISS')
						<include refid="ComRegr.ModrSetClause"/>
			WHERE	ANNC_NO = #{P_ANNC_NO , jdbcType=VARCHAR}
			AND		ANNC_NGR = #{P_ANNC_NGR , jdbcType=INTEGER}
			AND		ROUND_NO = #{P_ROUND_NO , jdbcType=INTEGER}
	</update>
	
	<!--  
     * <pre>
     * 1. 개요 : 복수 예가 순위 조회
     * 2. 처리내용 :
     *  	TABLE : T_BI_PLRL_ESTC(복수예가)
     * </pre>
     * @Query ID : selectCompnoPrdprcRankInqire
     * @date : 2015. 03. 25.
     * @author : 은우소프트 하성윤
     * @history : 
     *  =======================================================
     *  변경일             		작성자                     		변경내용  
     *  =======================================================
     *  2015. 03. 25.       은우소프트 하성윤              최초 작성 
     *  =======================================================   
     -->
	<select id="selectCompnoPrdprcRankInqire" resultType="dataEntity" >
		SELECT ROWNUM RNUM, PLR_ESTPC_NO
		FROM (
					SELECT	PLR_ESTPC_NO
							, ANNC_NO
							, ANNC_NGR
							, ROUND_NO
							, DRLT_CNT
					FROM	T_BI_PLRL_ESTC
					WHERE	ANNC_NO = #{P_ANNC_NO , jdbcType=VARCHAR}
					AND		ANNC_NGR = #{P_ANNC_NGR , jdbcType=INTEGER}
					AND		ROUND_NO = #{P_ROUND_NO , jdbcType=INTEGER}
					ORDER BY DRLT_CNT DESC, PLR_ESTPC_NO ASC
				)
	</select>
	
	<!--  
     * <pre>
     * 1. 개요 : 복수 예가 순위 저장
     * 2. 처리내용 :
     *  	TABLE : T_BI_PLRL_ESTC(복수예가)
     * </pre>
     * @Query ID : updateCompnoPrdprcRankStre
     * @date : 2015. 03. 25.
     * @author : 은우소프트 하성윤
     * @history : 
     *  =======================================================
     *  변경일             		작성자                     		변경내용  
     *  =======================================================
     *  2015. 03. 25.       은우소프트 하성윤              최초 작성 
     *  =======================================================   
     -->
	<update id="updateCompnoPrdprcRankStre" >
			UPDATE	T_BI_PLRL_ESTC
			SET 		ESTPC_RNK = #{P_ESTPC_RNK , jdbcType=INTEGER}
						,MOD_DT = TO_CHAR(SYSDATE, 'yyyyMMddHH24MISS')
						<include refid="ComRegr.ModrSetClause"/>
			WHERE	ANNC_NO = #{P_ANNC_NO , jdbcType=VARCHAR}
			AND		ANNC_NGR = #{P_ANNC_NGR , jdbcType=INTEGER}
			AND		ROUND_NO = #{P_ROUND_NO , jdbcType=INTEGER}
			AND		PLR_ESTPC_NO = #{P_PLR_ESTPC_NO , jdbcType=INTEGER}
	</update>
	
	<!--  
     * <pre>
     * 1. 개요 : 공고 진행상태 코드 수정 
     * 2. 처리내용 :
     *  	TABLE : T_BI_MST(입찰계획마스터)
     * </pre>
     * @Query ID : updatePblancPrstCdUpdt
     * @date : 2015. 03. 30.
     * @author : 은우소프트 하성윤
     * @history : 
     *  =======================================================
     *  변경일             		작성자                     		변경내용  
     *  =======================================================
     *  2015. 03. 30.       은우소프트 하성윤              최초 작성 
     *  =======================================================   
     -->
	<update id="updatePblancPrstCdUpdt" >
			UPDATE 	T_BI_MST
			SET		BID_PSCD = #{P_BID_PSCD, jdbcType=VARCHAR}
			<if test='P_OPNG_YN != null and P_OPNG_YN != "" '>
						, OPNG_YN = 'Y'
			</if>
						,MOD_DT = TO_CHAR(SYSDATE, 'yyyyMMddHH24MISS')
						<include refid="ComRegr.ModrSetClause"/>
			WHERE	ANNC_NO = #{P_ANNC_NO , jdbcType=VARCHAR}
			AND		ANNC_NGR = #{P_ANNC_NGR , jdbcType=INTEGER}
	</update>
	
	<!--  
     * <pre>
     * 1. 개요 : 업체 진행 이력 등록 
     * 2. 처리내용 :
     *  	TABLE : T_BI_VEND_HIST(업체진행이력)
     * </pre>
     * @Query ID : insertEntrpsProgrsHistRegist
     * @date : 2015. 03. 30.
     * @author : 은우소프트 하성윤
     * @history : 
     *  =======================================================
     *  변경일             		작성자                     		변경내용  
     *  =======================================================
     *  2015. 03. 30.       은우소프트 하성윤              최초 작성 
     *  =======================================================   
     -->
	<insert id="insertEntrpsProgrsHistRegist" >
		<selectKey keyProperty="P_HSTY_SN" resultType="int" order="BEFORE">
			SELECT 	NVL(MAX(HSTY_SN)+1,1) 
			FROM 	T_BI_VEND_HIST
			WHERE 	ANNC_NO = #{P_ANNC_NO, jdbcType=VARCHAR} 
			AND		ANNC_NGR = #{P_ANNC_NGR, jdbcType=INTEGER}
			AND		ROUND_NO = #{P_ROUND_NO, jdbcType=INTEGER}
			AND		VEND_REG_NO = #{P_VEND_REG_NO , jdbcType=VARCHAR}
		</selectKey>
		INSERT INTO T_BI_VEND_HIST
		(
			ANNC_NO
			,ANNC_NGR
			,ROUND_NO
			,VEND_REG_NO
			,HSTY_SN
			,BID_VEND_PSCD
			,RMK
			<include refid="ComRegr.RegrColumnClause"/>
		)
		VALUES
		(
			#{P_ANNC_NO, jdbcType=VARCHAR}
			,#{P_ANNC_NGR, jdbcType=INTEGER}
			,#{P_ROUND_NO, jdbcType=INTEGER}
			,#{P_VEND_REG_NO, jdbcType=VARCHAR}
			,#{P_HSTY_SN, jdbcType=INTEGER}
			,#{P_BID_VEND_PSCD, jdbcType=VARCHAR}
			,#{P_RMK, jdbcType=VARCHAR}
			<include refid="ComRegr.RegrValueClause"/>
		)
	</insert>
	
	<!--  
     * <pre>
     * 1. 개요 : 자동 입찰포기 등록
     * 2. 처리내용 :
     *  	TABLE : T_BI_VEND_HIST(복수예가)
     * </pre>
     * @Query ID : insertAtmcBiabRegist
     * @date : 2015. 03. 30.
     * @author : 은우소프트 하성윤
     * @history : 
     *  =======================================================
     *  변경일             		작성자                     		변경내용  
     *  =======================================================
     *  2015. 03. 30.       은우소프트 하성윤              최초 작성 
     *  =======================================================   
     -->
	<insert id="insertAtmcBiabRegist" >
		INSERT INTO T_BI_VEND_DTL
		(
			ANNC_NO
			,ANNC_NGR
			,ROUND_NO
			,VEND_REG_NO
			,BID_TPI_SECD
			,TPI_DT
			,TPI_IP
			,CHRGR_NM
			,TEL_NO
			,CP_NO
			,EMAL_ADDR
			,CERT_INHR_VAL
			,ORG_VAL
			,SIGN_VAL
			,SSN_VKEY
			,ORG_HASH_VAL
			,CERT_DN
			,SIGN_DT
			,SIGN_IP
			,RMK
			<include refid="ComRegr.RegrColumnClause"/>
		)
		VALUES
		(
			#{P_ANNC_NO, jdbcType=VARCHAR}
			,#{P_ANNC_NGR, jdbcType=INTEGER}
			,#{P_ROUND_NO, jdbcType=INTEGER}
			,#{P_VEND_REG_NO, jdbcType=VARCHAR}
			,#{P_BID_TPI_SECD, jdbcType=VARCHAR}
			,#{P_TPI_DT, jdbcType=VARCHAR}
			,#{P_TPI_IP, jdbcType=VARCHAR}
			,#{P_CHRGR_NM, jdbcType=VARCHAR}
			,#{P_TEL_NO, jdbcType=VARCHAR}
			,#{P_CP_NO, jdbcType=VARCHAR}
			,#{P_EMAL_ADDR, jdbcType=VARCHAR}
			,#{P_CERT_INHR_VAL, jdbcType=VARCHAR}
			,#{P_ORG_VAL, jdbcType=VARCHAR}
			,#{P_SIGN_VAL, jdbcType=VARCHAR}
			,#{P_SSN_VKEY, jdbcType=VARCHAR}
			,#{P_ORG_HASH_VAL, jdbcType=VARCHAR}
			,#{P_CERT_DN, jdbcType=VARCHAR}
			,#{P_SIGN_DT, jdbcType=VARCHAR}
			,#{P_SIGN_IP, jdbcType=VARCHAR}
			,#{P_RMK, jdbcType=VARCHAR}
			<include refid="ComRegr.RegrValueClause"/>
		)
	</insert>
	
	<!--  
     * <pre>
     * 1. 개요 : 업체 개찰 정보 등록
     * 2. 처리내용 :
     *  	TABLE : T_BI_VEND_BIOP(업체개찰)
     * </pre>
     * @Query ID : insertEntrpsOpengInfoRegist
     * @date : 2015. 03. 30.
     * @author : 은우소프트 하성윤
     * @history : 
     *  =======================================================
     *  변경일             		작성자                     		변경내용  
     *  =======================================================
     *  2015. 03. 30.       은우소프트 하성윤              최초 작성 
     *  =======================================================   
     -->
	<insert id="insertEntrpsOpengInfoRegist" >
		INSERT INTO T_BI_VEND_BIOP
		(
			ANNC_NO
			, ANNC_NGR
			, ROUND_NO
			, VEND_REG_NO
			, OPNG_RNK
			, OPNG_RSN
			<include refid="ComRegr.RegrColumnClause"/>
		)
		SELECT	M.ANNC_NO
					, M.ANNC_NGR
					, M.ROUND_NO
					, M.VEND_REG_NO
					, S.RANK AS OPNG_RNK
					, CASE WHEN S.RANK IS NULL THEN '낙찰하한율 미달' END
					<include refid="ComRegr.RegrValueClause"/>
		FROM		T_BI_VEND_MST M
					, (
						SELECT A.*
						FROM (
							<if test='P_SBID_MTCD.equals("40")'>
								<include refid="tcpcEnopInfo"></include>
							</if>
							<if test='P_SBID_MTCD.equals("31")'>
								<include refid="prjdEnopInfo"></include>
							</if>
							<if test='P_SBID_MTCD.equals("60")'>
								<include refid="highPcEnopInfo"></include>
							</if>
							<if test='!P_SBID_MTCD.equals("31") and !P_SBID_MTCD.equals("40") and !P_SBID_MTCD.equals("60")'>
								<include refid="lwetPcEnopInfo"></include>
							</if>							
						) A
					) S
		WHERE	M.ANNC_NO = S.ANNC_NO(+)
		AND		M.ANNC_NGR = S.ANNC_NGR(+)
		AND		M.ROUND_NO = S.ROUND_NO(+)
		AND		M.VEND_REG_NO = S.VEND_REG_NO(+)
		AND		M.BID_VEND_PSCD = 'OP06'
		AND		M.ANNC_NO = #{P_ANNC_NO , jdbcType=VARCHAR}
		AND		M.ANNC_NGR = #{P_ANNC_NGR , jdbcType=INTEGER}
		AND		M.ROUND_NO = #{P_ROUND_NO , jdbcType=INTEGER}
	</insert>
	
	<!--  
     * <pre>
     * 1. 개요 : 적격심사 업체 개찰 정보 조회
     * 2. 처리내용 :
     *  	TABLE : T_BI_VEND_MST(업체참여마스터)
     					, T_BI_MST(입찰계획마스터)
     					, T_BI_ESTC_MST(예가등록)
     * </pre>
     * @Query ID : prjdEnopInfo
     * @date : 2015. 03. 30.
     * @author : 은우소프트 하성윤
     * @history : 
     *  =======================================================
     *  변경일             		작성자                     		변경내용  
     *  =======================================================
     *  2015. 03. 30.       은우소프트 하성윤              최초 작성 
     *  =======================================================   
     -->
	<sql id="prjdEnopInfo">
		SELECT   A.ANNC_NO
					, A.ANNC_NGR
					, C.ROUND_NO
					, C.VEND_REG_NO
					, A.SBID_LWST_RT
					, B.SCH_PRCE_AMT
					, C.TNDR_AMT
					, ROW_NUMBER() OVER (ORDER BY C.TNDR_AMT) AS RANK
		FROM 	T_BI_MST A
					, T_BI_VEND_MST C
					, T_BI_ESTC_MST B
		WHERE	A.ANNC_NO = C.ANNC_NO
		AND		A.ANNC_NGR = C.ANNC_NGR
		AND		C.ANNC_NO = B.ANNC_NO(+)
		AND		C.ANNC_NGR = B.ANNC_NGR(+)
		AND		C.ROUND_NO = B.ROUND_NO(+)
		AND		C.BID_VEND_PSCD = 'OP06'
		AND		A.ANNC_NO = #{P_ANNC_NO , jdbcType=VARCHAR}
		AND		A.ANNC_NGR = #{P_ANNC_NGR , jdbcType=INTEGER}
		AND		C.ROUND_NO = #{P_ROUND_NO , jdbcType=INTEGER}
		AND		A.SBID_LWST_RT &lt; round( ((C.TNDR_AMT / CASE WHEN A.ESTPC_SECD = '180002' THEN A.ESTT_PRCE ELSE B.SCH_PRCE_AMT END ) *100), 3)
		ORDER BY RANK ASC
	</sql>
	
	<!--  
     * <pre>
     * 1. 개요 : 협상에의한 계약(기술가격종합평가) 업체 개찰 정보 조회
     * 2. 처리내용 :
     *  	TABLE : T_BI_VEND_MST(업체참여마스터)
     					, T_BI_MST(입찰계획마스터)
     * </pre>
     * @Query ID : tcpcEnopInfo
     * @date : 2015. 03. 30.
     * @author : 은우소프트 하성윤
     * @history : 
     *  =======================================================
     *  변경일             		작성자                     		변경내용  
     *  =======================================================
     *  2015. 03. 30.       은우소프트 하성윤              최초 작성 
     *  =======================================================   
     -->
	<sql id="tcpcEnopInfo">
		SELECT  C.ANNC_NO
					, C.ANNC_NGR
					, C.ROUND_NO
					, C.VEND_REG_NO
					, C.ESTM_SCR
					, C.PRCE_SCR
					, (C.ESTM_SCR + C.PRCE_SCR) AS SCORE
					, TNDR_AMT
					, ROW_NUMBER() OVER (ORDER BY (C.ESTM_SCR + C.PRCE_SCR) DESC, TNDR_AMT) AS RANK
		FROM 	T_BI_VEND_MST C
		WHERE	C.BID_VEND_PSCD = 'OP06'
		AND		C.ANNC_NO = #{P_ANNC_NO , jdbcType=VARCHAR}
		AND		C.ANNC_NGR = #{P_ANNC_NGR , jdbcType=INTEGER}
		AND		C.ROUND_NO = #{P_ROUND_NO , jdbcType=INTEGER}
		ORDER BY RANK ASC
	</sql>
	
	<!--  
     * <pre>
     * 1. 개요 : 협상에의한 계약(기술평가) 업체 개찰 정보 조회
     * 2. 처리내용 :
     *  	TABLE : T_BI_VEND_MST(업체참여마스터)
     					, T_BI_MST(입찰계획마스터)
     * </pre>
     * @Query ID : tchnlgyEnopInfo
     * @date : 2015. 03. 30.
     * @author : 은우소프트 하성윤
     * @history : 
     *  =======================================================
     *  변경일             		작성자                     		변경내용  
     *  =======================================================
     *  2015. 03. 30.       은우소프트 하성윤              최초 작성 
     *  =======================================================   
     -->
	<sql id="tchnlgyEnopInfo">
		SELECT  A.ANNC_NO
					, A.ANNC_NGR
					, C.VEND_REG_NO
					, C.ESTM_SCR
		FROM 	T_BI_MST A
					, T_BI_VEND_MST C
		WHERE	A.ANNC_NO = C.ANNC_NO
		AND		A.ANNC_NGR = C.ANNC_NGR
		AND		A.ROUND_NO = C.ROUND_NO
		AND		A.ANNC_NO = #{P_ANNC_NO , jdbcType=VARCHAR}
		AND		A.ANNC_NGR = #{P_ANNC_NGR , jdbcType=INTEGER}
		AND		A.ROUND_NO = #{P_ROUND_NO , jdbcType=INTEGER}
		ORDER BY ESTM_SCR DESC
	</sql>
	
	<!--  
     * <pre>
     * 1. 개요 : 최저가 업체 개찰 정보 조회
     * 2. 처리내용 :
     *  	TABLE : T_BI_VEND_MST(업체참여마스터)
     					, T_BI_MST(입찰계획마스터)
     * </pre>
     * @Query ID : lwetPcEnopInfo
     * @date : 2015. 03. 30.
     * @author : 은우소프트 하성윤
     * @history : 
     *  =======================================================
     *  변경일             		작성자                     		변경내용  
     *  =======================================================
     *  2015. 03. 30.       은우소프트 하성윤              최초 작성 
     *  =======================================================   
     -->
	<sql id="lwetPcEnopInfo">
		SELECT  C.ANNC_NO
					, C.ANNC_NGR
					, C.ROUND_NO
					, C.VEND_REG_NO
					, C.TNDR_AMT
					, RANK() OVER (ORDER BY C.TNDR_AMT) AS RANK
		FROM 	T_BI_VEND_MST C
		WHERE	C.BID_VEND_PSCD = 'OP06'
		AND		C.ANNC_NO = #{P_ANNC_NO , jdbcType=VARCHAR}
		AND		C.ANNC_NGR = #{P_ANNC_NGR , jdbcType=INTEGER}
		AND		C.ROUND_NO = #{P_ROUND_NO , jdbcType=INTEGER}
		ORDER BY RANK ASC
	</sql>
	
	<!--  
     * <pre>
     * 1. 개요 : 최고가 업체 개찰 정보 조회
     * 2. 처리내용 :
     *  	TABLE : T_BI_VEND_MST(업체참여마스터)
     					, T_BI_MST(입찰계획마스터)
     * </pre>
     * @Query ID : lwetPcEnopInfo
     * @date : 2015. 03. 30.
     * @author : 은우소프트 하성윤
     * @history : 
     *  =======================================================
     *  변경일             		작성자                     		변경내용  
     *  =======================================================
     *  2015. 03. 30.       은우소프트 하성윤              최초 작성 
     *  =======================================================   
     -->
	<sql id="highPcEnopInfo">
		SELECT  C.ANNC_NO
					, C.ANNC_NGR
					, C.ROUND_NO
					, C.VEND_REG_NO
					, C.TNDR_AMT
					, RANK() OVER (ORDER BY C.TNDR_AMT DESC) AS RANK
		FROM 	T_BI_VEND_MST C
		WHERE	C.BID_VEND_PSCD = 'OP06'
		AND		C.ANNC_NO = #{P_ANNC_NO , jdbcType=VARCHAR}
		AND		C.ANNC_NGR = #{P_ANNC_NGR , jdbcType=INTEGER}
		AND		C.ROUND_NO = #{P_ROUND_NO , jdbcType=INTEGER}
		ORDER BY RANK ASC
	</sql>
	
	<!--  
     * <pre>
     * 1. 개요 : 기술가격분리(기술가격입찰동시 - 최저가) 업체 개찰 정보 조회
     * 2. 처리내용 :
     *  	TABLE : T_BI_VEND_MST(업체참여마스터)
     					, T_BI_MST(입찰계획마스터)
     * </pre>
     * @Query ID : lwetPcEnopInfo
     * @date : 2015. 03. 30.
     * @author : 은우소프트 하성윤
     * @history : 
     *  =======================================================
     *  변경일             		작성자                     		변경내용  
     *  =======================================================
     *  2015. 03. 30.       은우소프트 하성윤              최초 작성 
     *  =======================================================   
     -->
	<sql id="tcpcLwetPcEnopInfo">
		SELECT   A.ANNC_NO
					, A.ANNC_NGR
					, C.VEND_REG_NO
					, C.ESTM_ELCD
					, C.TNDR_AMT
		FROM 	T_BI_MST A
					, T_BI_ESTC_MST B
					, T_BI_VEND_MST C
		WHERE	A.ANNC_NO = B.ANNC_NO(+)
		AND		A.ANNC_NGR = B.ANNC_NGR(+)
		AND		A.ANNC_NO = C.ANNC_NO
		AND		A.ANNC_NGR = C.ANNC_NGR
		AND		A.ANNC_NO = #{P_ANNC_NO , jdbcType=VARCHAR}
		AND		A.ANNC_NGR = #{P_ANNC_NGR , jdbcType=INTEGER}
		AND		NVL(C.ESTM_ELCD, 'T') != 'F'
		ORDER BY TNDR_AMT ASC
	</sql>
	
	
	<!--  
     * <pre>
     * 1. 개요 : 업체 입찰 정보 조회
     * 2. 처리내용 :
     *  	TABLE : T_BI_MST(입찰계획마스터)
     					, T_BI_VEND_DTL(업체참여마스터)
     					, VECI_PRCOEN2(조달협력업체)
     * </pre>
     * @Query ID : selectEntrpsBidInfoInqire
     * @date : 2015. 03. 31.
     * @author : 은우소프트 하성윤
     * @history : 
     *  =======================================================
     *  변경일             		작성자                     		변경내용  
     *  =======================================================
     *  2015. 03. 31.       은우소프트 하성윤              최초 작성 
     *  =======================================================   
     -->
	<select id="selectEntrpsBidInfoInqire" resultType="dataEntity">
		SELECT  VEND.ANNC_NO
					, VEND.ANNC_NGR
					, VEND.ROUND_NO
					, VEND.VEND_REG_NO
					, VEND.BID_VEND_PSCD
					, F_CDVAL_INQIRE('BID_VEND_PSCD', VEND.BID_VEND_PSCD) AS BID_VEND_PSCD_NM
					, VEND.BID_ELCD
					, F_CDVAL_INQIRE('BID_ELCD', VEND.BID_ELCD) AS BID_ELCD_NM
					, VEND.NT_ELGB_RSN
					, VEND.REVW_DE
					, VEND.ESTM_ELCD
					, VEND.ESTM_NT_ELGB_RSN
					, VEND.ESTM_ELCD
					, F_CDVAL_INQIRE('ESTM_ELCD', VEND.ESTM_ELCD) AS ESTM_ELCD_NM
					, VEND.ESTM_NT_ELGB_RSN
					
					, VEND.PRCE_SCR
					, VEND.ESTM_SCR
					
					, A.SBID_MTCD
					, F_CDVAL_INQIRE('SBID_MTCD', A.SBID_MTCD) AS SBID_MTCD_NM
					, A.ELGB_LMT_SCR
					, A.TCHN_SCR_RT
					, A.PRCE_SCR_RT
					, A.BID_PSCD
					
					, CU.VEND_NM
		FROM		T_BI_MST A
					, T_BI_ROUND B
					, T_BI_VEND_MST VEND
					,T_CU_MST CU
		WHERE	1=1
		AND		A.ANNC_NO = B.ANNC_NO
		AND		A.ANNC_NGR = B.ANNC_NGR
		AND		B.ANNC_NO = VEND.ANNC_NO
		AND		B.ANNC_NGR = VEND.ANNC_NGR
		AND		B.ROUND_NO = VEND.ROUND_NO
		AND		VEND.VEND_REG_NO = CU.VEND_REG_NO
		AND		VEND.ANNC_NO = #{P_ANNC_NO , jdbcType=VARCHAR}
		AND		VEND.ANNC_NGR = #{P_ANNC_NGR , jdbcType=INTEGER}
		AND		VEND.ROUND_NO = #{P_ROUND_NO , jdbcType=INTEGER}
		AND		VEND.VEND_REG_NO = #{P_VEND_REG_NO , jdbcType=VARCHAR}
	</select>
	
	
	<!--  
     * <pre>
     * 1. 개요 : 업체 적격검토 등록 
     * 2. 처리내용 :
     *  	TABLE : T_BI_VEND_MST(업체참여마스터)
     * </pre>
     * @Query ID : updateEntrpsProperExmntRegist
     * @date : 2015. 03. 31.
     * @author : 은우소프트 하성윤
     * @history : 
     *  =======================================================
     *  변경일             		작성자                     		변경내용  
     *  =======================================================
     *  2015. 03. 31.       은우소프트 하성윤              최초 작성 
     *  =======================================================   
     -->
	<update id="updateEntrpsProperExmntRegist" >
		UPDATE		T_BI_VEND_MST
		SET			MOD_DT = TO_CHAR(SYSDATE, 'yyyyMMddHH24MISS')
						, REVW_DE = TO_CHAR(SYSDATE, 'yyyyMMdd')
						<if test='P_BID_ELCD != null'>, BID_ELCD = #{P_BID_ELCD , jdbcType=VARCHAR}</if>
						<if test='P_NT_ELGB_RSN != null'>, NT_ELGB_RSN = #{P_NT_ELGB_RSN , jdbcType=VARCHAR}</if>
						<if test='P_ESTM_SCR != null'>, ESTM_SCR = #{P_ESTM_SCR , jdbcType=VARCHAR}</if>
						<if test='P_ESTM_ELCD != null'>, ESTM_ELCD = #{P_ESTM_ELCD , jdbcType=VARCHAR}</if>
						<if test='P_ESTM_NT_ELGB_RSN != null'>, ESTM_NT_ELGB_RSN = #{P_ESTM_NT_ELGB_RSN , jdbcType=VARCHAR}</if>
						<include refid="ComRegr.ModrSetClause"/>
		WHERE		ANNC_NO = #{P_ANNC_NO , jdbcType=VARCHAR}
		AND			ANNC_NGR = #{P_ANNC_NGR , jdbcType=INTEGER}
		AND			ROUND_NO = #{P_ROUND_NO, jdbcType=INTEGER}
		AND			VEND_REG_NO = #{P_VEND_REG_NO , jdbcType=VARCHAR}
	</update>
	
	<!--  
     * <pre>
     * 1. 개요 : 가격점수등록
     * 2. 처리내용 :
     *  	TABLE : T_BI_VEND_MST(업체참여마스터)
     * </pre>
     * @Query ID : updatePcScoreUpdt
     * @date : 2015. 03. 31.
     * @author : 은우소프트 하성윤
     * @history : 
     *  =======================================================
     *  변경일             		작성자                     		변경내용  
     *  =======================================================
     *  2015. 03. 31.       은우소프트 하성윤              최초 작성 
     *  =======================================================   
     -->
	<update id="updatePcScoreUpdt" >
			UPDATE 	T_BI_VEND_MST
			SET		PRCE_SCR = TO_NUMBER(#{P_PRCE_SCR})
						,MOD_DT = TO_CHAR(SYSDATE, 'yyyyMMddHH24MISS')
						<include refid="ComRegr.ModrSetClause"/>
			WHERE	ANNC_NO = #{P_ANNC_NO , jdbcType=VARCHAR}
			AND		ANNC_NGR = #{P_ANNC_NGR , jdbcType=INTEGER}
			AND		ROUND_NO = #{P_ROUND_NO , jdbcType=INTEGER}
			AND		VEND_REG_NO = #{P_VEND_REG_NO , jdbcType=VARCHAR}
	</update>
	
	<!--  
     * <pre>
     * 1. 개요 : 가격점수 산출
     * 2. 처리내용 :
     *  	TABLE : DUAL
     * </pre>
     * @Query ID : selectPcScoreComput
     * @date : 2015. 05. 07.
     * @author : 은우소프트 하성윤
     * @history : 
     *  =======================================================
     *  변경일             		작성자                     		변경내용  
     *  =======================================================
     *  2015. 05. 07.       은우소프트 하성윤              최초 작성 
     *  =======================================================   
     -->
	<select id="selectPcScoreComput" resultType="String">
		SELECT	FEBI_GET_NEGO_PRCE_SCORE(#{P_ANNC_NO}, #{P_ANNC_NGR},#{P_ROUND_NO}, #{P_VEND_REG_NO}) FROM DUAL
	</select>
	
	<!--  
     * <pre>
     * 1. 개요 : 업체 진행 상태 수정
     * 2. 처리내용 :
     *  	TABLE : T_BI_VEND_MST(업체참여마스터)
     * </pre>
     * @Query ID : updateEntrpsProgrsSttusUpdt
     * @date : 2015. 03. 31.
     * @author : 은우소프트 하성윤
     * @history : 
     *  =======================================================
     *  변경일             		작성자                     		변경내용  
     *  =======================================================
     *  2015. 03. 31.       은우소프트 하성윤              최초 작성 
     *  =======================================================   
     -->
	<update id="updateEntrpsProgrsSttusUpdt" >
			UPDATE 	T_BI_VEND_MST
			SET		BID_VEND_PSCD = #{P_BID_VEND_PSCD , jdbcType=VARCHAR}
						,MOD_DT = TO_CHAR(SYSDATE, 'yyyyMMddHH24MISS')
						<include refid="ComRegr.ModrSetClause"/>
			WHERE	ANNC_NO = #{P_ANNC_NO , jdbcType=VARCHAR}
			AND		ANNC_NGR = #{P_ANNC_NGR , jdbcType=INTEGER}
			AND		ROUND_NO = #{P_ROUND_NO , jdbcType=INTEGER}
			AND		VEND_REG_NO = #{P_VEND_REG_NO , jdbcType=VARCHAR}
	</update>
	
	<insert id="insertTchnScr">
		INSERT INTO T_BI_VEND_BIOP(
			ANNC_NO
			,ANNC_NGR
			,ROUND_NO
			,VEND_REG_NO
			,SBID_YN
			,SBID_AMT
			,SBID_DT
			,OPNG_RNK
			,TCHN_ESTM_SCR
			,ELGB_ESTM_SCR
			,ELGB_CD
			,SBID_ABND_YN
			,SBID_ABND_RSN
			,ABND_PROC_IP
			,NEGO_NTFC_YN
			,NEGO_DT
			,NEGO_CNTN
			,OPNG_RSN
			,FILE_GRP_NO
			,OPNG_IP
			,RMK
			<include refid="ComRegr.RegrColumnClause"/>
		)VALUES(
			#{P_ANNC_NO, jdbcType=VARCHAR}
			,#{P_ANNC_NGR, jdbcType=INTEGER}
			,#{P_ROUND_NO, jdbcType=INTEGER}
			,#{P_VEND_REG_NO, jdbcType=VARCHAR}
			,#{P_SBID_YN, jdbcType=VARCHAR}
			,#{P_SBID_AMT, jdbcType=INTEGER}
			,#{P_SBID_DT, jdbcType=VARCHAR}
			,#{P_OPNG_RNK, jdbcType=INTEGER}
			,#{P_TCHN_ESTM_SCR, jdbcType=INTEGER}
			,#{P_ELGB_ESTM_SCR, jdbcType=INTEGER}
			,#{P_ELGB_CD, jdbcType=VARCHAR}
			,#{P_SBID_ABND_YN, jdbcType=VARCHAR}
			,#{P_SBID_ABND_RSN, jdbcType=VARCHAR}
			,#{P_ABND_PROC_IP, jdbcType=VARCHAR}
			,#{P_NEGO_NTFC_YN, jdbcType=VARCHAR}
			,#{P_NEGO_DT, jdbcType=VARCHAR}
			,#{P_NEGO_CNTN, jdbcType=VARCHAR}
			,#{P_OPNG_RSN, jdbcType=VARCHAR}
			,#{P_FILE_GRP_NO, jdbcType=VARCHAR}
			,#{P_OPNG_IP, jdbcType=VARCHAR}
			,#{P_RMK, jdbcType=VARCHAR}
			<include refid="ComRegr.RegrValueClause"/>
		)
	</insert>
	
	<update id="updateTchnScrRegist" >
		<selectKey keyProperty="P_JUMSU" resultType="int" order="BEFORE">
			SELECT 85 * (TCHN_SCR_RT / 10)
		 	FROM	T_BI_MST
		 	WHERE	ANNC_NO = #{P_ANNC_NO , jdbcType=VARCHAR}
		 	AND		ANNC_NGR = #{P_ANNC_NGR , jdbcType=INTEGER}
		</selectKey>
		UPDATE		T_BI_VEND_MST
		SET			ESTM_SCR = #{P_ESTM_SCR, jdbcType=INTEGER}
						,NT_ELGB_RSN = CASE WHEN #{P_ESTM_SCR, jdbcType=INTEGER} >= #{P_JUMSU} THEN ''
												   ELSE '기술점수 미달' END
						,ESTM_ELCD = CASE WHEN #{P_ESTM_SCR, jdbcType=INTEGER} >= #{P_JUMSU} THEN 'ELGB'
											   ELSE 'NT_ELGB' END
						,BID_VEND_PSCD = CASE WHEN #{P_ESTM_SCR, jdbcType=INTEGER} >= #{P_JUMSU} THEN 'OP04'
											   		   ELSE 'OP14' END										   
						,MOD_DT = TO_CHAR(SYSDATE, 'yyyyMMddHH24MISS')
						<include refid="ComRegr.ModrSetClause"/>
		WHERE		ANNC_NO = #{P_ANNC_NO , jdbcType=VARCHAR}
		AND			ANNC_NGR = #{P_ANNC_NGR , jdbcType=INTEGER}
		AND			ROUND_NO = #{P_ROUND_NO, jdbcType=INTEGER}
		AND			VEND_REG_NO = #{P_VEND_REG_NO , jdbcType=VARCHAR}
	</update>
	
	<update id="updateEstmElcdRegist">
		UPDATE		T_BI_VEND_MST
		SET			ESTM_ELCD = #{P_ESTM_ELCD, jdbcType=VARCHAR}
						,NT_ELGB_RSN = CASE WHEN #{P_ESTM_ELCD, jdbcType=VARCHAR} = 'ELGB' THEN ''
												   ELSE '기술평가부적격' END
						,BID_VEND_PSCD = CASE WHEN #{P_ESTM_ELCD, jdbcType=VARCHAR} = 'ELGB'  THEN 'OP04'
											   		   ELSE 'OP14' END
						,MOD_DT = TO_CHAR(SYSDATE, 'yyyyMMddHH24MISS')
						<include refid="ComRegr.ModrSetClause"/>
		WHERE		ANNC_NO = #{P_ANNC_NO , jdbcType=VARCHAR}
		AND			ANNC_NGR = #{P_ANNC_NGR , jdbcType=INTEGER}
		AND			ROUND_NO = #{P_ROUND_NO, jdbcType=INTEGER}
		AND			VEND_REG_NO = #{P_VEND_REG_NO , jdbcType=VARCHAR}
	</update>
	
	<select id="selectSmprBid"  resultType="dataEntity">
		SELECT 	OPNG_RNK 
					,COUNT(OPNG_RNK)
		FROM 	T_BI_VEND_BIOP
		WHERE	ANNC_NO = #{P_ANNC_NO , jdbcType=VARCHAR}
		AND		ANNC_NGR = #{P_ANNC_NGR , jdbcType=INTEGER}
		AND		ROUND_NO = #{P_ROUND_NO, jdbcType=INTEGER}					
		GROUP BY OPNG_RNK
		HAVING COUNT(OPNG_RNK) > 1
	</select>
	
	<select id="selectVendMstRank" resultType="dataEntity">
		SELECT	A.VEND_REG_NO
					,(SELECT BIZRNO FROM T_CU_MST WHERE VEND_REG_NO = A.VEND_REG_NO) AS BIZRNO
					,A.SIGN_DT
		FROM	T_BI_VEND_DTL A
					,T_BI_VEND_BIOP B
		WHERE	A.ANNC_NO = B.ANNC_NO
		AND		A.ANNC_NGR = B.ANNC_NGR
		AND		A.ROUND_NO = B.ROUND_NO
		AND		A.VEND_REG_NO = B.VEND_REG_NO
		AND		A.BID_TPI_SECD = 'OP03'
		AND		A.ANNC_NO = #{P_ANNC_NO , jdbcType=VARCHAR}
		AND		A.ANNC_NGR = #{P_ANNC_NGR , jdbcType=INTEGER}
		AND		A.ROUND_NO = #{P_ROUND_NO, jdbcType=INTEGER}
		AND		B.OPNG_RNK = #{P_OPNG_RNK, jdbcType=VARCHAR}
	</select>
	
	<select id="selectDatpList" resultType="dataEntity">
		SELECT ANNC_NO
					,ANNC_NGR
					,ROUND_NO
					,TPI_SN
					,VEND_REG_NO_ENC
					,VEND_REG_NO
					,BID_VEND_PSCD
					,TNDR_AMT
					,SBID_YN
					,SBID_AMT
					,SBID_DT
					,OPNG_IP
					,OPNG_RNK
					,FILE_GRP_NO
					,REGR_ID
					,REGR_NM
					,REG_DT
					,MODR_ID
					,MODR_NM
					,MOD_DT
					,CONN_IP
		FROM	T_BI_DATP_MST
		WHERE	ANNC_NO = #{P_ANNC_NO , jdbcType=VARCHAR}
		AND		ANNC_NGR = #{P_ANNC_NGR , jdbcType=INTEGER}
		AND		ROUND_NO = #{P_ROUND_NO, jdbcType=INTEGER}
		ORDER BY TNDR_AMT ASC 
	</select>
	
	<select id="selectDatpCnt" resultType="int">
		SELECT 	COUNT(1)
		FROM(	SELECT 	VEND_REG_NO_ENC
					FROM 	T_BI_DATP_MST 
					WHERE 	ANNC_NO = #{P_ANNC_NO , jdbcType=VARCHAR}
					AND		ANNC_NGR = #{P_ANNC_NGR , jdbcType=INTEGER}
					AND		ROUND_NO = #{P_ROUND_NO, jdbcType=INTEGER}
					GROUP BY VEND_REG_NO_ENC )
	</select>
	
	<update id="updateDatpOpen">
		UPDATE 	T_BI_DATP_MST
		SET			VEND_REG_NO = #{P_VEND_REG_NO , jdbcType=VARCHAR}
						,BID_VEND_PSCD = #{P_BID_VEND_PSCD , jdbcType=VARCHAR}
						,OPNG_RNK = #{P_OPNG_RNK , jdbcType=INTEGER}
						,MOD_DT = TO_CHAR(SYSDATE, 'yyyyMMddHH24MISS')
						<include refid="ComRegr.ModrSetClause"/>
		WHERE		ANNC_NO = #{P_ANNC_NO , jdbcType=VARCHAR}
		AND			ANNC_NGR = #{P_ANNC_NGR , jdbcType=INTEGER}
		AND			ROUND_NO = #{P_ROUND_NO, jdbcType=INTEGER}
		AND			TPI_SN = #{P_TPI_SN, jdbcType=INTEGER}
	</update>
	
	<!--  
     * <pre>
     * 1. 개요 : 협상결과 조회 
     * 2. 처리내용 :
     * </pre>
     * @Query ID : negoRsltDetailInquire
     * @date : 2019. 02. 27.
     * @author : 은우소프트 맹경열
     * @history : 
     *  =======================================================
     *  변경일             		작성자                     		변경내용  
     *  =======================================================
     *  2019. 02. 27.       은우소프트 맹경열              최초 작성 
     *  =======================================================   
     -->
	<select id="negoRsltDetailInquire" resultType="dataEntity">
		SELECT	BIOP.ANNC_NO
					, BIOP.ANNC_NGR
					, BIOP.ROUND_NO
					, BIOP.VEND_REG_NO
					, BIOP.NEGO_NTFC_YN
					, BIOP.NEGO_DT
					, BIOP.NEGO_CNTN
					, BIOP.FILE_GRP_NO
					, BIOP.LT_NEGO_AMT
					, (SELECT BID_PSCD FROM T_BI_MST WHERE ANNC_NO = BIOP.ANNC_NO AND ANNC_NGR = BIOP.ANNC_NGR ) AS BID_PSCD
					
		FROM		T_BI_VEND_BIOP BIOP
		WHERE	1=1
		AND		BIOP.ANNC_NO = #{P_ANNC_NO , jdbcType=VARCHAR}
		AND		BIOP.ANNC_NGR = #{P_ANNC_NGR , jdbcType=INTEGER}
		AND		BIOP.ROUND_NO = #{P_ROUND_NO, jdbcType=INTEGER}
		AND		BIOP.VEND_REG_NO = #{P_VEND_REG_NO, jdbcType=VARCHAR}
	</select>
		
	<!--  
     * <pre>
     * 1. 개요 : 협상결과 업데이트 
     * 2. 처리내용 :
     * </pre>
     * @Query ID : updateNegoRsltInfo
     * @date : 2019. 02. 27.
     * @author : 은우소프트 맹경열
     * @history : 
     *  =======================================================
     *  변경일             		작성자                     		변경내용  
     *  =======================================================
     *  2019. 02. 27.       은우소프트 맹경열              최초 작성 
     *  =======================================================   
     -->
	<update id="updateNegoRsltInfo">
		UPDATE	T_BI_VEND_BIOP BIOP
		SET		MOD_DT = TO_CHAR(SYSDATE, 'yyyyMMddHH24MISS')
					, NEGO_NTFC_YN = 'Y'
					, NEGO_DT = TO_CHAR(SYSDATE, 'yyyyMMddHH24MISS')
					, NEGO_CNTN = #{P_NEGO_CNTN, jdbcType=VARCHAR}
					, LT_NEGO_AMT = #{P_LT_NEGO_AMT, jdbcType=INTEGER}
		WHERE	1=1
		AND		BIOP.ANNC_NO = #{P_ANNC_NO , jdbcType=VARCHAR}
		AND		BIOP.ANNC_NGR = #{P_ANNC_NGR , jdbcType=INTEGER}
		AND		BIOP.ROUND_NO = #{P_ROUND_NO, jdbcType=INTEGER}
		AND		BIOP.VEND_REG_NO = #{P_VEND_REG_NO, jdbcType=VARCHAR}
	</update>	
	
</mapper>