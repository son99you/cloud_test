//version: 3.1.8_e54ce34761bf3c9776b1c6dd23fc7a4531eaad89
//update: Thu Jan 16 10:11:57 2020 +0900

!function(e,t,n){"use strict";function i(e){return"object"==typeof e&&"undefined"!=typeof e.error&&"number"==typeof e.error&&"undefined"!=typeof e.message&&"string"==typeof e.message}function r(e){e.keystrokeEncryption?yt.webToken.SecKeyVendor=e.keystrokeEncryption:yt.webToken.SecKeyVendor="null",c(e.servicePort),"undefined"!=typeof e.language&&s(V[e.language]),"undefined"!=typeof e.replayAttack&&u(e.replayAttack),Y.vestCert=e.vestCert,Y.yessign=e.yessign,Y.serverStorage=[],Y.serverStorageObj=e.serverStorage,"undefined"!=typeof e.serverStorage&&"undefined"!=typeof e.serverStorage.hibiscus&&"undefined"!=typeof e.serverStorage.hibiscus.use&&1==e.serverStorage.hibiscus.use&&L.hibiscus.setDomain(e.serverStorage.hibiscus.targetUrl);for(var t in e.serverStorage)Y.serverStorage.push(e.serverStorage[t])}function o(e,t){"undefined "!=typeof e.yessign&&"undefined"!=typeof e.yessign.use&&1==e.yessign.use&&"undefined"==typeof Y.yessign.serverNonce?L.hibiscus.openCertInit({},function(e){return i(e)?void(5704e3==e.error&&t({init:!1,call:!0})):(Y.yessign.serverNonce=e.serverNonce,void t({init:!0,call:!0}))}):t({init:!0,call:!1})}function c(e){e&&(yt.webToken.servicePort=e)}function s(e){e&&(yt.webToken.language=e)}function u(e){yt.webToken.replayAttack=e}function a(e){if(null==e||S(e))return!1;var t=e.length;return g(e)||M(e)||0===t||"number"==typeof t&&t>0&&t-1 in e}function d(e,t,n){var i,r;if(e)if(m(e))for(i in e)"prototype"==i||"length"==i||"name"==i||e.hasOwnProperty&&!e.hasOwnProperty(i)||t.call(n,e[i],i,e);else if(M(e)||a(e)){var o="object"!=typeof e;for(i=0,r=e.length;i<r;i++)(o||i in e)&&t.call(n,e[i],i,e)}else if(e.forEach&&e.forEach!==d)e.forEach(t,n,e);else for(i in e)e.hasOwnProperty(i)&&t.call(n,e[i],i,e);return e}function f(){}function y(e){return"undefined"==typeof e}function p(e){return"undefined"!=typeof e}function v(e){return null!==e&&"object"==typeof e}function g(e){return"string"==typeof e}function l(e){return"number"==typeof e}function h(e){return"[object Date]"===Object.prototype.toString.call(e)}function m(e){return"function"==typeof e}function C(e){return"[object RegExp]"===Object.prototype.toString.call(e)}function S(e){return e&&e.window===e}function b(e){return"[object File]"===Object.prototype.toString.call(e)}function T(e){return"[object Blob]"===Object.prototype.toString.call(e)}function k(e){return"boolean"==typeof e}function I(e,t){var i=t;return"string"==typeof e&&"$"===e.charAt(0)&&"$"===e.charAt(1)?i=n:S(t)?i="$WINDOW":t&&document===t&&(i="$DOCUMENT"),i}function B(e,t){return y(e)?n:JSON.stringify(e,I,t?"  ":null)}function w(e){return g(e)?JSON.parse(e):e}function E(){return!0}function D(e){for(var t=1,n=arguments.length;t<n;t++){var i=arguments[t];if(i)for(var r=Object.keys(i),o=0,c=r.length;o<c;o++){var s=r[o];e[s]=i[s]}}}function A(e){return new yt.util.ByteBuffer(e).data}function O(e,n){return new t.error(e,"get error code:"+e+" reason:"+n)}function P(e){var t,n;return t=ytcrypto.md.sha256.create().update(e),n=t.digest(),n.data}function K(e){var t=L.getHash(e),n=t.slice(0,16);t=L.getHash(t);var i=t.slice(0,16);return{key:i,iv:n}}function x(e,t,n,i){var r;r=i?ytcrypto.seed.createEncryptionCipher:ytcrypto.seed.createDecryptionCipher;var o=r(n,"CBC");return o.start(t),o.update(yt.util.createBuffer(e)),o.finish(),o.output.getBytes()}function N(e){var t=["RSA PRIVATE KEY","CERTIFICATE","PRIVATEKEY"];return t[e]}function H(e){var t,n,i=[],r=e.split("");for(t=0;t<e.length;t++){var o=cp949Table[r[t].charCodeAt()];n=o?yt.util.hexToBytes(o.toString(16)):r[t],i.push(n)}return i.join("")}function R(e,t){var i,r=Object.keys(e);for(i=0;i<r.length;i++)if(e[r[i]]===t)return r[i];return n}function F(e){for(var t,n=0,i=[],r=yt.util.bytesToHex(e);n<r.length;){var o=r.substr(n,4),c=R(cp949Table,parseInt("0x"+o));c?(n+=4,t=String.fromCharCode(c)):(n+=2,t=String.fromCharCode("0x00"+o.substr(0,2))),i.push(t)}return i.join("")}var L=e.vest||(e.vest={}),U={},Y={},V={0:"kor",1:"eng",2:"jpn"},M=Array.isArray,j=function(e){return g(e)?e.trim():e},_={isMSIE:function(){return document.documentMode===n?e.navigator.userAgent.toLowerCase().indexOf("msie 7.0")!==-1&&7:document.documentMode||!1},isCompatiblilityMode:function(){return this.isMSIE()&&e.navigator.userAgent.toLowerCase().indexOf("trident")!==-1},isChrome:function(){return e.navigator.userAgent.toLowerCase().indexOf("chrome")!==-1},isFirefox:function(){return e.navigator.userAgent.toLowerCase().indexOf("firefox")!==-1},isSafari:function(){return e.navigator.userAgent.toLowerCase().indexOf("safari")!==-1},isOpera:function(){return e.navigator.userAgent.toLowerCase().indexOf("opr")!==-1},isSwing:function(){return e.navigator.userAgent.toLowerCase().indexOf("swing")!==-1},getBrowser:function(){var e="IE";return L.browser.isChrome()?e="CHROME":L.browser.isSafari()?e="SAFARI":L.browser.isFirefox()?e="FIREFOX":L.browser.isOpera()?e="OPERA":L.browser.isSwing()&&(e="SWING"),e}},$={isWindows:function(){return"win32"===e.navigator.platform.toLowerCase()||"win64"===e.navigator.platform.toLowerCase()},isMac:function(){return"macintel"===e.navigator.platform.toLowerCase()},isLinux32:function(){},isLinux64:function(){return"Linux x86_64"===e.navigator.platform.toLowerCase()}},G={encodeCharset:function(e,n){if(!g(e)||!g(n))return e;switch(n.toLowerCase()){case"euc-kr":return t.util.encodeEUCKR(e);case"utf-8":return t.util.encodeUTF8(e);case"cp949":return H(e);default:return e}},decodeCharset:function(e,n){if(!g(e)||!g(n))return e;switch(n.toLowerCase()){case"euc-kr":return t.util.euckrToUTF8(e);case"utf-8":return t.util.decodeUTF8(e);case"cp949":return F(e);default:return e}},pemToBase64:function(e){return g(e)?e.replace("-----BEGIN CERTIFICATE-----","").replace("-----END CERTIFICATE-----","").replace(/\r/gi,"").replace(/\n/gi,""):e},base64ToPem:function(e,t){var n="\n";n+="-----BEGIN "+N(t)+"-----\n";for(var i=0;i<e.length;i+=64)n+=e.substring(i,i+64)+"\n";return n+="-----END "+N(t)+"-----\n"},encodeBytes:function(e,i){if(e!==n&&""!=e)switch(i.toLowerCase()){case"hex":return t.util.bytesToHex(e);case"base64":return t.util.encode64(e);default:return t.util.bytesToHex(e)}},encodeArrayBuffer:function(e,i){if(e!==n&&""!=e){var r=ytcrypto.util.createBuffer(e).data;switch(i.toLowerCase()){case"hex":return t.util.bytesToHex(r);case"base64":return t.util.encode64(r);default:return t.util.bytesToHex(r)}}},decodeString:function(e,i){if(e!==n&&""!=e)switch(i.toLowerCase()){case"hex":return t.util.hexToBytes(e);case"base64":return t.util.decode64(e);default:return t.util.hexToBytes(e)}},decodeHex:function(e){if(e!==n&&""!=e)return t.util.hexToBytes(e)},hexDecimal:function(e,t){if(!g(e)||!g(t))return e},certToBase64:function(e){return t.util.encode64(yt.util.hexToBytes(e.toHex()))}},X=function(e){function i(e){return v(e)&&e instanceof t.pki.Certificate||e.hasOwnProperty("certIdentifier")}function r(e){if(!i(e))throw"Not a Certificate"}function o(e){return e.isAfter(moment())}function c(e){var t=e.diff(moment(),"day");return 0==t&&Number(e.format("YYYYMMDDHHmmss"))-Number(moment().format("YYYYMMDDHHmmss"))<0?-1:t}function s(e,t){try{return e.decrypt(t)}catch(n){throw L.error("2200")}}function u(e,t){try{return e.encrypt(t)}catch(n){throw L.error("2201")}}function a(e){try{var n=t.asn1.fromString(e);return t.pkcs8.createEncryptedPrivateKeyInfoFromAsn1(n)}catch(i){throw"not a encrypted private key info"}}function f(e){try{var n=t.asn1.fromBytes(e);return t.pkcs8.createEncryptedPrivateKeyInfoFromAsn1(n)}catch(i){throw"not a encrypted private key info"}}function y(e,n){var i=t.asn1.fromDer(e),r=t.cms.createSignedData();r.fromAsn1(i,function(e){return e instanceof t.error?void n(L.error("2010",e.getReason())):void r.verify({},function(e){return e instanceof t.error?void n(L.error("2011",e.getReason())):void n(r.content)})})}function p(e,n,i,r){var o,c={};o=t.pki.Certificate.fromBytes(n),c.name="RSASSA-PKCS1-v1_5",c.hash={name:"SHA-256"},o.publicKey.verify(c,e,i,function(e){return e instanceof t.error?void r(L.error("2012",e.getReason())):void r(i)})}var g={AUTHORITY_KEY_IDENTIFIER:"2.5.29.35",SUBJECT_KEY_IDENTIFIER:"2.5.29.14",KEY_USAGE:"2.5.29.15",CERTIFICATE_POLICIES:"2.5.29.32",SUBJECT_ALTERNATIVE_NAME:"2.5.29.17",CRL_DISTRIBUTION_POINTS:"2.5.29.31",AUTHORITY_INFO_ACCESS:"1.3.6.1.5.5.7.1.1",EXTKEYUSAGE:"2.5.29.37",BASICCONSTRAINTS:"2.5.29.19"},l=function(e,i){var r,s,u,a,f,y,p,v,l,m,C,S,b,T,k,I,B,w,E,D,A,O,P,K,x=e._cert;r=x.version,s=e.serialNumber,u=yt.oids[x.signatureOid],a=t.util.bytesToHex(x.signature),f=e.issuer,y={to:moment(e.validity.notAfter),from:moment(e.validity.notBefore)},p=e.subject,u.toUpperCase().indexOf("RSA")!==-1&&"undefined"!=typeof x.publicKey.n&&(v="RSA "+x.publicKey.n.bitLength()),l=t.util.bytesToHex(yt._asn1.toDer(ytcrypto.pki.publicKeyToAsn1(x.publicKey)).getBytes()),m=yt.util.bytesToHex(ytcrypto.pki.publicKeyToAsn1(x.publicKey).value[1].value),m="00"==m.substr(0,2)?m.substr(2,m.length):m,d(x.extensions,function(e){switch(e.id){case g.AUTHORITY_KEY_IDENTIFIER:C=t.util.bytesToHex(e.value),D=t.util.bytesToHex(t.asn1.fromBytes(e.value)._asn.value[0].value);break;case g.CRL_DISTRIBUTION_POINTS:k=e.value.substr(e.value.indexOf("ldap://"));break;case g.AUTHORITY_INFO_ACCESS:w=yt._asn1.fromDer(e.value).value[0].value[1].value;break;case g.SUBJECT_KEY_IDENTIFIER:E=e.subjectKeyIdentifier;break;case g.EXTKEYUSAGE:for(var n in e)"1.2.410.200004.10.1.2"==n&&(O="id_kisa_HSM");break;case g.BASICCONSTRAINTS:var i="none",r="none";e.cA&&(i="CA"),""!=e.pathLenConstraint&&"undefined"!=typeof e.pathLenConstraint&&(r=e.pathLenConstraint),A="subject Type="+i+", path Length Contraint="+r}}),b=[],d(e.extensions.keyUsage,function(e,t){"name"!==t&&"value"!==t&&e&&b.push(t)}),S=e.extensions.certificatePolicies!=n&&e.extensions.certificatePolicies.policies!=n?Object.keys(e.extensions.certificatePolicies.policies)[0]:null,T=e.extensions.subjectAltName!=n?t.util.bytesToHex(e.extensions.subjectAltName.value):null,P=e.extensions.subjectAltName!=n?e.extensions.subjectAltName.realName:null,S&&(I=e.extensions.certificatePolicies.policies[S].userNotice,B=e.extensions.certificatePolicies.policies[S].CPSuri),K=i,this.getVersion=function(){return r+1+""},this.getSerialNumber=function(){return s},this.getSignatureAlgorithm=function(){return u},this.getSignatureValue=function(){return a},this.getIssuer=function(){return f},this.getValidityTo=function(e){return y.to.format(e)},this.getValidityFrom=function(e){return y.from.format(e)},this.getSubject=function(){return p},this.getPublickeyAlgorithm=function(){return v},this.getPublickey=function(){return l},this.getPubkey=function(){return m},this.getAuthorityKeyIdentifier=function(){return C},this.getPolicy=function(){return S},this.getKeyUsage=function(){return b},this.getSubjectAlternativeName=function(){return T},this.getCrlDistributionPoint=function(){return k},this.getUserNotice=function(){return I},this.getCps=function(){return B},this.getAuthorityInfoAccess=function(){return w},this.isValid=function(){return o(y.to)},this.getAvailableDays=function(){return c(y.to)},this.toHex=function(){return e.toAsn1().toHex()},this.getSubjectKeyIdentifier=function(){return E},this.getIssuerKeyIdentifier=function(){return D},this.getBasicConstranints=function(){return A},this.getExtKeyUsage=function(){return O},this.getRealName=function(){return P},this.getSaveCert=function(){return K},this.toShortCert=function(){return new h(e)}};l.fromHex=function(e){return new l(t.pki.Certificate.fromString(e))},l.fromBytes=function(e){return new l(t.pki.Certificate.fromBytes(e))};var h=function(e){var n,i,s,u,a,d,f="YYYY-MM-DD HH:mm:ss";r(e),e instanceof t.pki.Certificate?(n=e.subject,i=e.issuer,s=Object.keys(e.extensions.certificatePolicies.policies)[0],u=e.serialNumber,d=e.subject,a={to:moment(e.validity.notAfter),from:moment(e.validity.notBefore)}):(n=e.subject.split(", ").join(","),i=e.issuer.split(", ").join(","),s=e.policy.id.split(",")[0],u=e.serial.toLowerCase(),d={cert:e.certIdentifier,key:e.keyIdentifier,kmCert:e.kmCertIdentifier,kmKey:e.kmKeyIdentifier},a={to:moment(e.validTo,f),from:moment(e.validFrom,f)}),this.toCertificate=function(){return new l(e)},this.getSubject=function(){return n},this.getIssuer=function(){return i},this.getPolicy=function(){return s},this.getSerial=function(){return u},this.getIdentifier=function(){return d},this.setIdentifier=function(e){d=e},this.getValidityTo=function(e){return a.to.format(e)},this.getValidityFrom=function(e){return a.from.format(e)},this.isValid=function(){return o(a.to)},this.getAvailableDays=function(){return c(a.to)}},m=function(e){var t,i,r,s,u,a,d,f,y,p="YYYY-MM-DD HH:mm:ss";t=e.subject,i=e.issuer,r=e.policyOID,s="undefined"!=typeof e.serial?e.serial.toLowerCase():"",a={cert:e.certIdentifier,key:e.keyIdentifier,kmCert:e.kmCertIdentifier,kmKey:e.kmKeyIdentifier},u={to:moment(e.notAfter,p),from:moment(e.notBefore,p)},d=e.fingerprint,f="undefined"!=typeof e.cloud?e.cloud:n,y=e.source,this.getSource=function(){return y},this.getCloud=function(){return f},this.getFP=function(){return d},this.getSubject=function(){return t},this.getIssuer=function(){return i},this.getPolicy=function(){return r},this.getSerial=function(){return s},this.getIdentifier=function(){return a},this.setIdentifier=function(e){a=e},this.getValidityTo=function(e){return u.to.format(e)},this.getValidityFrom=function(e){return u.from.format(e)},this.isValid=function(){return o(u.to)},this.getAvailableDays=function(){return c(u.to)}},C=function(n,i,r,o){function c(e,n,i,r){var o=t.cms.createSignedData(),c={key:n.privateKey,certificate:y};o.setContent(e),o.sign(c,function(e){e instanceof t.error&&r(L.error("2000",e.getReason())),i(o.toAsn1().toBytes())})}function a(e,t,n,i){var r={name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};t.privateKey.sign(r,e,function(e){return e instanceof yt.error?void i(L.error("2001",e.getReason())):void n(e)})}function d(e,n,i,r){var o,c=t.cms.createSignedData(),s={key:n.privateKey,certificate:y};o=ytcrypto.md.sha256.create(),o.update(e),e=ytcrypto.pkcs1.createDigestInfo(o),c.setDigestInfo(e),c.sign(s,function(e){e instanceof t.error&&r(L.error("2002",e.getReason())),i(c.toAsn1().toBytes())})}function f(e,n){return t.util.hexToBytes(e.envelopeVid(n.idn,n.recipientCertificate))}var y,p,v,g,h=!1;y=n,p=i,r&&o&&(h=!0,v=r,g=o),this.getCertificate=function(){return new l(y)},this.toString=function(t){var n={};return"undefined"!=typeof t?(n={signCert:e.encodeBytes(y.toAsn1().toBytes(),t.encoding),signPri:e.encodeBytes(p.toAsn1().toBytes(),t.encoding)},h&&(n.kmCert=e.encodeBytes(v.toAsn1().toBytes(),t.encoding),n.kmPri=e.encodeBytes(g.toAsn1().toBytes(),t.encoding))):(n={signCert:y.toAsn1().toHex(),signPri:p.toAsn1().toHex()},h&&(n.kmCert=v.toAsn1().toHex(),n.kmPri=g.toAsn1().toHex())),B(n)},this.toObject=function(t){var n={signCert:e.encodeBytes(y.toAsn1().toBytes(),t.encoding),signPri:e.encodeBytes(p.toAsn1().toBytes(),t.encoding)};return h&&(n.kmCert=e.encodeBytes(v.toAsn1().toBytes(),t.encoding),n.kmPri=e.encodeBytes(g.toAsn1().toBytes(),t.encoding)),n},this.toPFX=function(e,n){var i,r;"undefined"==typeof n.algorithm&&(n.algorithm="3des");try{r=s(p,e)}catch(o){throw L.error("2200","password fail")}try{i=t.pkcs12.PFX.generateToAsn1({key:r,certificate:y},e,n)}catch(o){return L.error("2600","generateToAsn1 error("+o+")")}return i.toBytes()},this.makeSignature=function(n,i,r,o,u,y){var v="",g=function(i){u({signature:e.encodeBytes(i,o.encoding),vidMessage:""===v?"":e.encodeBytes(v,o.encoding),extentions:{dn:n.getSubject(),certificate:e.encodeBytes(t.util.hexToBytes(n.toHex()),o.encoding),r:"",realName:n.getRealName()}})};try{var l=s(p,r)}catch(h){y(h)}if(i=e.encodeCharset(i,o.charset),o.vid){var m=G.pemToBase64(o.vid.recipientCertificate);o.vid.recipientCertificate=G.base64ToPem(m,1),v=f(l,o.vid)}"undefined"!=typeof o.signtype&&0==o.signtype?a(i,l,g,y):"undefined"!=typeof o.signtype&&4==o.signtype?d(i,l,g,y):c(i,l,g,y)},this.changePassword=function(e,t,n,i){try{p=u(s(p,e),t)}catch(r){return void i(r)}n(!0)},this.verifyPin=function(e,t,n){try{s(p,e)}catch(i){return void n(i)}t(!0)},this.verifyVID=function(e,n,i,r,o,c){var s,u,a,d,f,y,p;try{a=t.pki.Certificate.fromBytes(t.util.hexToBytes(e.toHex())),s=t.pkcs8.createEncryptedPrivateKeyInfoFromAsn1(t.asn1.fromDer(t.util.hexToBytes(n.signPri))),u=s.decrypt(i),d=yt.pkcs8.createPrivateKeyInfoFromAsn1(yt.asn1.fromBytes(u.toAsn1().toBytes())),f=a.extensions}catch(v){return void c(v)}if(f.subjectAltName.hasOwnProperty("vid")){y=f.subjectAltName.vid;try{p=d.verifyVid(y,r)}catch(v){return void c(v)}p?o(p):c("VID 검증에 실패하였습니다.")}}};C.fromString=function(e){var n=w(e);return n.kmCert&&n.kmPri?new C(t.pki.Certificate.fromString(n.signCert),a(n.signPri),t.pki.Certificate.fromString(n.kmCert),a(n.kmPri)):new C(t.pki.Certificate.fromString(n.signCert),a(n.signPri))},C.fromBytes=function(e){return e.kmCert&&e.kmPri?(new l.fromBytes(e.signCert),f(e.signPri),t.pki.Certificate.fromBytes(e.kmCert),f(e.kmPri)):new C(t.pki.Certificate.fromBytes(e.signCert),f(e.signPri))},C.fromPFX=function(n,i,r){var o,c,s,a,d,f;return"undefined"!=typeof r?(f=ytcrypto.util.bytesToHex(e.decodeString(n,r.encoding)),""==f&&(f=ytcrypto.crypto.util.arrayBufferToHex(e.decodeString(n,r.encoding)))):(f=ytcrypto.util.bytesToHex(n),""==f&&(f=ytcrypto.crypto.util.arrayBufferToHex(n))),o=t.pkcs12.PFX.fromString(f,i),c=o.contents[o.contents.keys[0]].cert,s=u(o.contents[0].key,i),"undefined"!=typeof o.contents.keys[1]&&(a=o.contents[o.contents.keys[1]].cert,d=u(o.contents[1].key,i)),new C(c,s,a,d)};var S=function(n,i){n=e.encodeCharset(n,i.charset);var r;return r=new t.pki.PersonInfoReq(n),i.realName&&r.request("realName"),i.birthDate&&r.request("birthDate"),i.gender&&r.request("gender"),i.nationalInfo&&r.request("nationalInfo"),r=r.toAsn1(),r=r.toBytes()};return{Certificate:l,ShortCert:h,OpenCert:m,CertificateSet:C,generateUCPID:S,verifySignature:function(n,i,r,o,c){var s=function(n){return n instanceof t.error?void c(n):void o(e.decodeCharset(n,r.charset))};"object"==typeof i?p(e.decodeString(n,r.encoding),e.decodeString(i.certOrKey,r.encoding),e.encodeCharset(i.plain,r.charset),s):y(e.decodeString(n,r.encoding),s)}}}(G),W=function(t,r,o,c){function s(e,t){m(t)?t(e):u(e)}function u(e){alert(e.getReason())}function a(e,t){var n=[];return M(t)&&t.forEach(function(t){(e===l.SYSTEM&&"DISK DRIVE"===t.type&&t.systemDrive||e===l.TOKEN&&("HARDWARE TOKEN"===t.type||"PKCS#11 TOKEN"===t.type)||e===l.LOCALDISK&&t.type===e&&!t.systemDrive||e===l.SAVETOKEN&&"SmartCard TOKEN"===t.type||e===l.PHONE&&"MobiSign"===t.type||e===l.PHONE&&"Mobile USIM"===t.type||e===l.PHONE&&"Ubikey"===t.type||e===l.SECUREDISK&&t.type===l.SECUREDISK||e===l.SAVETOKEN&&("SmartCard TOKEN"===t.type||"USBKey TOKEN"===t.type)||e===l.USBKEY&&"USBKey TOKEN"===t.type||e===l.PFXNPKI&&"PFX NPKI"===t.type||e===l.ALL)&&n.push(t)}),n}function y(e){return e instanceof t.error}function v(e,n,i,r){t.webToken.getTokenList(n,function(t){return y(t)?void s(t,r):void i(a(e,t))})}function g(e,t){for(var i="",r="",o="",c=e.split(","),s=0;s<c.length;s++){if(i="",r="",i=c[s].split("="),r="upper"==t?i[0].toUpperCase().replace(/\s/gi,""):"lower"==t?i[0].toLowerCase().replace(/\s/gi,""):i[0].replace(/\s/gi,""),i[1]==n);else for(var u=1;u<i.length;u++)r+="="+i[u];o+=r+","}return o.substr(0,o.length-1)}var l={ALL:"ALL",TOKEN:"TOKEN",SYSTEM:"SYSTEM DRIVE",LOCALDISK:"DISK DRIVE",UBIKEY:"UBIKEY",SAVETOKEN:"SmartCard TOKEN",PHONE:"PHONE",SECUREDISK:"Secure Disk",PFXNPKI:"PFX NPKI",USBKEY:"USBKey TOKEN",PKCS11:"PKCS#11 TOKEN",HIBISCUS:"HIBISCUS"};return{TYPE:l,ERROR:t.webToken.error,getVersion:function(e,i){t.webToken.getVersion(n,function(t){return y(t)?void s(t,i):void(e||f)(t)})},getTokenList:function(e,t,n,i){var r,o,c,s;"function"==typeof t&&"function"==typeof n&&"undefined"==typeof i?(r=e,o={},c=t,s=n):"function"==typeof n&&"function"==typeof i&&(r=e,o=t,c=n,s=i),v(r,o,c,s)},getBackupedTokenList:function(e,n,i){t.webToken.getBackupedTokenList(function(t){return y(t)?void s(t,i):(t=a(e,t),d(t,function(e){"undefined"!=typeof e.SecureTokenIdentifier&&(e.tokenIdentifier=e.SecureTokenIdentifier,delete e.SecureTokenIdentifier)}),void n(t))})},getCertificates:function(e,r,c,u,a,p,v,g){var l={};c!==n&&0!=c&&(l.mode=c),u!==n&&0!=u&&(l.OID=u),a!==n&&0!=a&&(l.CAName=a);"undefined"!=typeof p.secureDiskList&&p.secureDiskList?t.webToken.getBackupedCertificateList(e,r,l,p,function(e){if(y(e))return void s(e,g);var t=[];d(e,function(e){t.push(new o.ShortCert(e))}),(v||f)(t)}):"HIBISCUS"==e?L.hibiscus.getCertificateList({filter:l},function(e){if(i(e))return void s(e,g);var n=[];d(e.list,function(e){var i=new o.ShortCert(yt.pki.Certificate.fromBytes(t.util.decode64(e.signCertificate)));"undefined"!=typeof e.kmCertificate&&""!==e.kmCertificate?i.setIdentifier({cert:e.name+1,key:e.name+2,kmCert:e.name+3,kmKey:e.name+4}):i.setIdentifier({cert:e.name+1,key:e.name+2,kmCert:e.name+1,kmKey:e.name+4}),n.push(i)}),(v||f)(n)}):t.webToken.getCertificateList(e,r,l,p,function(e){if(y(e))return void s(e,g);var t=[];d(e,function(e){t.push(new o.ShortCert(e))}),(v||f)(t)})},getCertificate:function(n,r,c,u){if(n==W.TYPE.HIBISCUS){var a=r.substr(r.length-1),d=r.substr(0,r.length-1);L.hibiscus.getCertificate(d,{identifier:a},function(t){return i(t)?void s(t,u):void(c||f)(new o.Certificate(yt.pki.Certificate.fromBytes(yt.util.decode64(t.certificate)),e.navigator.userAgent))})}else t.webToken.getCertificate(n,r,function(e){return y(e)?void s(e,u):void(c||f)(new o.Certificate(e.cert,e.path))})},getCACertificate:function(e,n,r,c,u){var a="",d="";if(e==L.token.TYPE.HIBISCUS){var p=n.substr(0,n.length-1);L.hibiscus.getCACertificate(p,{},function(e){return i(e)?void s(e,u):(d=e.rootCertHash,"ca"==r?a=e.caCertificate:"root"==r&&(a=e.rootCertificate),void yt.pki.Certificate.fromBytes(yt.util.decode64(a),function(e){(c||f)({cert:new o.Certificate(e),rootCertHash:d})}))})}else t.webToken.getCACertificate(e,n,function(e){if(y(e))return void s(e,u);var n="",i=e.rootCertHash;"ca"==r?n=e.caCertificate:"root"==r&&(n=e.rootCertificate),yt.pki.Certificate.fromBytes(t.util.decode64(n),function(e){(c||f)({cert:new o.Certificate(e),rootCertHash:i})})})},makeSignature:function(c,u,a,d,p,v,g){p=p?p:{};var l,h=new Array;if(!p.bytes)if("[object Array]"===Object.prototype.toString.call(d)){for(var m=new Array,C=0;C<d.length;C++)m[C]=d[C];for(;m.length>0;)h.push(r.encodeCharset(m.shift(),p.charset))}else h=r.encodeCharset(d,p.charset);if(p.vid&&p.vid.recipientCertificate&&(p.vid.recipientCertificate=r.pemToBase64(p.vid.recipientCertificate)),p.customStr){var S,b;S=ytcrypto.md.sha256.create(),S.update(p.customStr),b=S.digest(),p.customSID=r.encodeBytes(b.data,"base64")}if("undefined"!=typeof p.signInputType&&2==p.signInputType&&(p.plainSizeLimit=10),"undefined"!=typeof p.signOutputType&&1==p.signOutputType&&(l=r.encodeCharset(p.outputfile,p.charset)),c==L.token.TYPE.HIBISCUS){var T,k="undefined"!=typeof a.cert?a.cert.substr(a.cert.length-1):n;T="undefined"==typeof a.cert?a:p.customStr?a.cert:a.cert.substr(0,a.cert.length-1),"undefined"!=typeof p.opencertP12&&(p.opencert=p.opencertP12,p.last=k),L.hibiscus.generateSignature(T,d,u,p,function(c){if(i(c))return void s(c,function(e){g(e,v)});var u;if("undefined"!=typeof p.signOutputType&&1==p.signOutputType)u=r.encodeBytes(t.util.decode64(c.signature),p.encoding);else if("[object Array]"===Object.prototype.toString.call(c.signature)){var a=c.signature;for(u=[];a.length>0;)u.push(r.encodeBytes(t.util.decode64(a.shift()),p.encoding))}else u=r.encodeBytes(t.util.decode64(c.signature),p.encoding);var d,y;if(d="undefined"!=typeof c.certificate?c.certificate:"",y="undefined"!=typeof c.r?c.r:"","undefined"!=typeof p.opencertP12&&5==k){d=new o.Certificate(yt.pki.Certificate.fromBytes(yt.util.decode64(d)),e.navigator.userAgent);var l=d.getRealName();(v||f)({signature:u,vidMessage:c.encryptedVIDRandom===n?"":r.encodeBytes(t.util.hexToBytes(c.encryptedVIDRandom),p.encoding),extentions:{dn:t.util.decodeUTF8(t.util.decode64(T)),certificate:r.encodeBytes(t.util.hexToBytes(d.toHex()),p.encoding),r:r.encodeBytes(t.util.decode64(y),p.encoding),realName:l}})}else L.hibiscus.getCertificate(T,{identifier:k},function(a){if(i(a))return void s(a,g);a=new o.Certificate(yt.pki.Certificate.fromBytes(yt.util.decode64(a.certificate)),e.navigator.userAgent);var d=a.getRealName();(v||f)({signature:u,vidMessage:c.encryptedVIDRandom===n?"":r.encodeBytes(t.util.hexToBytes(c.encryptedVIDRandom),p.encoding),extentions:{dn:t.util.decodeUTF8(t.util.decode64(T)),certificate:r.encodeBytes(t.util.hexToBytes(a.toHex()),p.encoding),r:r.encodeBytes(t.util.decode64(y),p.encoding),realName:d}})})})}else t.webToken.generateSignature(c,u,a.cert,a.key,h,l,p,function(e){if(y(e))return void s(e,function(e){g(e,v)});var i;if("undefined"!=typeof p.signOutputType&&1==p.signOutputType)i=r.decodeCharset(t.util.decode64(e.file),p.charset);else if("[object Array]"===Object.prototype.toString.call(e.signature)){var u=e.signature;for(i=[];u.length>0;)i.push(r.encodeBytes(u.shift(),p.encoding))}else i=r.encodeBytes(e.signature,p.encoding);"undefined"!=typeof e.usimCert?yt.pki.Certificate.fromBytes(t.util.decode64(e.usimCert),function(c){var s=new o.Certificate(c,"usim"),u=s.getRealName();(v||f)({signature:i,vidMessage:e.encryptedVIDRandom===n?"":r.encodeBytes(e.encryptedVIDRandom,p.encoding),extentions:{dn:e.dn===n?"":t.util.decodeUTF8(e.dn),certificate:r.encodeBytes(t.util.hexToBytes(s.toHex()),p.encoding),r:e.r===n?"":r.encodeBytes(e.r,p.encoding),realName:u}})}):t.webToken.getCertificate(c,a.cert,function(c){if(y(e))return void s(e,function(e){g(e,v)});var u=new o.Certificate(c.cert,c.path),a=u.getRealName();(v||f)({signature:i,vidMessage:e.encryptedVIDRandom===n?"":r.encodeBytes(e.encryptedVIDRandom,p.encoding),extentions:{dn:e.encryptedVIDRandom===n?"":t.util.decodeUTF8(e.dn),certificate:r.encodeBytes(t.util.hexToBytes(u.toHex()),p.encoding),r:e.encryptedVIDRandom===n?"":r.encodeBytes(e.r,p.encoding),realName:a}})})})},makeSignatureFromKoscom:function(e,o,c,u,a,d,p){if(a=a?a:{},a.bytes||(u=r.encodeCharset(u,a.charset)),a.vid&&a.vid.recipientCertificate&&(a.vid.recipientCertificate=r.pemToBase64(a.vid.recipientCertificate)),a.customStr){var v,g;v=ytcrypto.md.sha256.create(),v.update(a.customStr),g=v.digest(),a.customSID=r.encodeBytes(g.data,"base64")}if(e==L.token.TYPE.HIBISCUS){var l;l=a.customStr?c.cert:c.cert.substr(0,c.cert.length-1),L.hibiscus.generateSignature(l,u,o,a,function(e){return i(e)?void s(e,function(e){p(e,d)}):void(d||f)({signature:r.encodeBytes(e.signature,a.encoding),vidMessage:e.encryptedVIDRandom===n?"":r.encodeBytes(e.encryptedVIDRandom,a.encoding)})})}else t.webToken.generateSignatureFromKoscom(e,o,c.cert,c.key,u,a,function(e){return y(e)?void s(e,function(e){p(e,d)}):void(d||f)({signature:r.encodeBytes(e.signature,a.encoding),vidMessage:e.encryptedVIDRandom===n?"":r.encodeBytes(e.encryptedVIDRandom,a.encoding),extentions:{dn:t.util.decodeUTF8(e.dn),certificate:r.encodeBytes(e.certificate,a.encoding),r:r.encodeBytes(e.r,a.encoding)}})})},verifySignature:function(e,n,o,c,u){var a;"undefined"!=typeof o.signInputType&&2==o.signInputType?(e=r.encodeCharset(e,o.charset),o.plainSizeLimit=10):e=r.decodeString(e,o.encoding),"undefined"!=typeof o.signOutputType&&1==o.signOutputType&&(a=r.encodeCharset(o.outputfile,o.charset)),"object"==typeof n&&("undefined"!=typeof n.certOrKey&&(n.certOrKey=r.decodeString(n.certOrKey,o.encoding)),"undefined"!=typeof n.plain&&(n.plain=r.encodeCharset(n.plain,o.charset)));var d=function(){t.webToken.verifySignature(e,a,n,o,function(e){if(y(e))return void(e.code==yt.webToken.error.NOT_LOAD||e.code==yt.webToken.error.LOST_CONNECTION?p():s(e,u));var n;n="undefined"!=typeof o.signOutputType&&1==o.signOutputType?r.decodeCharset(t.util.decode64(e.file),o.charset):r.decodeCharset(t.util.decode64(e.verifyResult),o.charset),(c||f)(n)})},p=function(){e=t.util.encode64(e),L.hibiscus.verifySignature(e,n,o,function(e){if(i(e))return void s(e,u);var n;n=r.decodeCharset(t.util.decode64(e.verifyResult),o.charset),(c||f)(n)})};d()},verifyData:function(e,i,c,u,a,d){"string"==typeof c.plain&&(c.plain=r.encodeCharset(c.plain,u.charset)),t.webToken.verifySignatureFromKoscom(e,c,u,function(c){if(y(c))return void s(c,d);if(1==i){var p=t.cms.createSignedData(),v=t.asn1.fromBytes(t.util.decode64(e)),l=function(e){if(y(e))return void s(e,d);e="";var t=new o.Certificate(p.certificates[0]);e+="$dn=",e+=g(t.getSubject(),"lower"),e+="$data=",e+=r.decodeCharset(p.content,u.charset),e+="$serial=",e+=L.util.serialFilterForKoscom(t.getSerialNumber()),e+="$from=",e+=t.getValidityFrom("YYYY-MM-DD HH:mm:ss"),e+="$to=",e+=t.getValidityTo("YYYY-MM-DD HH:mm:ss"),"id_kisa_HSM"==t.getExtKeyUsage()&&(e+="$hsm=ok"),e+="$certificate=",e+=r.encodeBytes(yt.util.hexToBytes(t.toHex()),u.encoding),e+="$pubkey=",e+=r.encodeBytes(yt.util.hexToBytes(t.getPubkey()),u.encoding),(a||f)(e)};return void p.fromAsn1(v,l,n)}(a||f)(r.decodeCharset(t.util.decode64(c.verifyResult),u.charset))})},validateCertificate:function(e,i,r,o,c){""!=r&&r!=n||(r=2),t.webToken.ValidateCertificate(e,i.cert,r,function(e){return y(e)?void s(e,c):void(o||f)(e)})},setTokenOptions:function(e,n,i,r){t.webToken.setTokenOptions(e,n,function(e){return y(e)?void s(e,r):void(i||f)(!0)})},setIssueOptions:function(e,n,i,r,o,c,u,a,d){t.webToken.issueCertificate(e,n,i,r,o,c,u,function(e){return y(e)?void s(e,d):void(a||f)(e)})},updateCertificate:function(e,n,i,r,o,c,u,a,d,p){t.webToken.updateCertificate(e,n.cert,n.key,i,r,o,c,u,a,function(e){return y(e)?void s(e,p):void(d||f)(e)})},setRecoverOptions:function(e,n,i,r,o,c,u,a){t.webToken.recoverCertificate(e,n,i,r,o,c,function(e){return y(e)?void s(e,a):void(u||f)(e)})},getPCIdentityInfo:function(e,n,i,r){t.webToken.getPCIdentityInfo(e,n,function(e){return y(e)?void s(e,r):void(i||f)(e.pcidentity)})},getMacAddress:function(e,n,i){t.webToken.getMacAddress(e,function(e){return y(e)?void s(e,i):void(n||f)(e.mac)})},verifyPin:function(e,n,r,o,c){if("hibiscus"==e||"HIBISCUS"==e){var u=n.cert.substr(0,n.cert.length-1);L.hibiscus.verifyPin(u,r,{},function(e){return i(e)?void s(e,c):void(o||f)(!0)})}else t.webToken.verifyPin(e,n.key,r,function(e){return y(e)?void s(e,c):void(o||f)(!0)})},changePin:function(e,n,r,o,c,u,a){"hibiscus"==e||"HIBISCUS"==e?L.hibiscus.changePin(n.cert,r,o,{},function(e){return i(e)?void s(e,a):void(u||f)(!0)}):t.webToken.changePin(e,n.cert,n.key,r,o,c,function(e){return y(e)?void s(e,a):void(u||f)(!0)})},importP12:function(e,r,o,c,u,a,d){if("hibiscus"==e||"HIBISCUS"==e){var p=u.pfx,v=u.timeStamp!==n?u.timeStamp:"undefined";L.hibiscus.importP12(L.signHelper.decodeString(p,u.encoding),r,{timeStamp:v},function(e){return i(e)?void s(e,d):void(a||f)(e.dn)})}else t.webToken.importCertificate(e,r,o,c,u,function(e){return y(e)?void s(e,d):void(a||f)(!0)})},importCertificate:function(e,t,r,o,c,u){var a=o.timeStamp!==n?o.timeStamp:"undefined";"hibiscus"!=e&&"HIBISCUS"!=e||L.hibiscus.importCertificate(yt.util.decode64(t.cert),yt.util.decode64(t.key),"undefined"==typeof t.kmCert?"":yt.util.decode64(t.kmCert),"undefined"==typeof t.kmKey?"":yt.util.decode64(t.kmKey),r,{timeStamp:a},function(e){return alert("core::importCertificate"+JSON.stringify(e)),i(e)?void s(e,u):void(c||f)(!0)})},exportP12:function(e,n,i,r,o,c,u){t.webToken.exportCertificate(e,n.cert,n.key,i,r,o,function(e){if(y(e))return void s(e,u);var t=!0;p(e.pfxCert)&&(t=L.signHelper.encodeBytes(L.signHelper.decodeString(e.pfxCert,"base64"),o.encoding)),(c||f)(t)})},changeStorageMedia:function(e,n,i,r,o,c,u,a,d){t.webToken.changeStorage(e,n,i.cert,i.key,r,o,c,u,function(e){return y(e)?void s(e,d):void(a||f)(!0)})},removeFromMedia:function(e,n,r,o,c,u){if("hibiscus"==e||"HIBISCUS"==e){var a=r.cert.substr(0,r.cert.length-1);L.hibiscus.deleteCertificate(a,n,{},function(e){return i(e)?void s(e,u):void(c||f)(!0)})}else t.webToken.deleteCertificate(e,n,r.cert,r.key,o,function(e){return y(e)?void s(e,u):void(c||f)(!0)})},suspend:function(e,n,i,r,o,c,u){o.reason=6,t.webToken.revokeCertificate(e,n.cert,n.key,i,r,o,function(e){
return y(e)?void s(e,u):void(c||f)(!0)})},revoke:function(e,n,i,r,o,c,u){o.reason=1,t.webToken.revokeCertificate(e,n.cert,n.key,i,r,o,function(e){return y(e)?void s(e,u):void(c||f)(!0)})},setMatchedContext:function(e,n,o,c,u,a,d,p,v){function l(e,t){for(var n=0;n<t.length;n++)e.push(t[n])}function h(e){for(var t in e){e[t].showRenewal=!1;var n=moment(e[t].validTo,"YYYYMMDDHHmmss"),i=n.diff(moment(),"day");0==i&&Number(n.format("YYYYMMDDHHmmss"))-Number(moment().format("YYYYMMDDHHmmss"))<0&&(i=-1),i>=0&&i<30&&(e[t].showRenewal=!0),e[t].exipreDay=i}return e}var m,C,S;S=e,m=ytcrypto.md.sha256.create(),m.update(S),C=m.digest();var b=0,T=function(e,n){return null==Y.serverStorage[e]||"undefined"==typeof Y.serverStorage[e]||"undefined"!=typeof n&&"undefined"!=typeof n.hasSession&&n.hasSession?(n.list=h(n.list),void(p||f)(n)):void("cert"==Y.serverStorage[e].type&&Y.serverStorage[e].use?t.webToken.setMatchedContext(r.encodeBytes(C.data,"base64"),u,g(o,"upper"),c,a,d,function(t){return y(t)?void(Y.serverStorage[e].error?s(t,v):T(++e,n)):(1==t.hasSession?n.list=t.list:l(t.list,n.list),void T(++e,t))}):"hibiscus"==Y.serverStorage[e].type&&Y.serverStorage[e].use?L.hibiscus.setMatchedContext(C.data,u,g(o,"upper"),c,d,function(t){return i(t)&&Y.serverStorage[e].error?void(Y.serverStorage[e].error?s(t,v):T(++e,n)):(t.list=L.util.HibiscusCertListToVestCertCertList(t.list),1==t.hasSession?n.list=t.list:l(t.list,n.list),void T(++e,t))}):T(++e,n))};T(b,{list:[]})},unSetMatchedContext:function(e,n,o){var c,u;c=ytcrypto.md.sha256.create(),c.update(e),u=c.digest();var a=0,d=function(e){return null==Y.serverStorage[e]||"undefined"==typeof Y.serverStorage[e]?void(n||f)(!0):void("cert"==Y.serverStorage[e].type&&Y.serverStorage[e].use?t.webToken.unsetMatchedContext(r.encodeBytes(u.data,"base64"),function(t){return y(t)&&Y.serverStorage[e].error?void s(t,o):void d(++e)}):"hibiscus"==Y.serverStorage[e].type&&Y.serverStorage[e].use?L.hibiscus.unSetMatchedContext(u.data,{},function(t){return i(t)&&Y.serverStorage[e].error?void s(t,o):void d(++e)}):d(++e))};d(a)},makeCustomSession:function(e,n,o,c,u,a){var d,p;d=ytcrypto.md.sha256.create(),d.update(e),p=d.digest(),"hibiscus"==n||"HIBISCUS"==n?L.hibiscus.makeCustomSession(p.data,o.cert,c,{},function(e){return i(e)?void s(e,a):void(u||f)(e)}):t.webToken.makeCustomSession(r.encodeBytes(p.data,"base64"),n,o.cert,o.key,c,function(e){return y(e)?void s(e,a):void(u||f)(e)})},tray:function(e,n,i,r,o){t.webToken.operateTray(e,n,i,function(e){return y(e)?void s(e,o):void(r||f)(!0)})},getE2EInfo:function(e,n,i){t.webToken.getE2EInfo(e,function(e){if(y(e))return void s(e,i);var t={publicKey:"",sessionID:"",indexTable:""};if("undefined"!=typeof e.publicKey&&(t.publicKey=e.publicKey),"undefined"!=typeof e.sessionID&&(t.sessionID=e.sessionID),"undefined"!=typeof e.indexTable){var r=yt.util.decode64(e.indexTable);t.indexTable=r.split(",").map(String)}(n||f)(t)})},unload:function(){t.webToken.unLoad()},getHash:function(e,n,i,r,o){var c,u=function(){if(0==i){var e;e=ytcrypto.md.sha1.create().update(n),c=e.digest()}else if(1==i){var t;t=ytcrypto.md.sha256.create().update(n),c=t.digest()}else{var r;r=ytcrypto.md.md5.create().update(n),c=r.digest()}};t.webToken.getHash(e,n,i,function(n){if(y(n)){if(n.code!=yt.webToken.error.NOT_LOAD&&n.code!=yt.webToken.error.LOST_CONNECTION)return void s(n,o);u(),e=1,c.data=t.util.encode64(c.data),n.hash=c.data}(r||f)(n.hash)})},encrypt:function(e,n,i,o,c,u){e=r.encodeCharset(e,o.charset),t.webToken.encrypt(e,n,i,function(e){return y(e)?void s(e,u):void(c||f)(r.encodeBytes(e,o.encoding))})},decrypt:function(e,n,i,o,c,u){e=r.decodeString(e,o.encoding),t.webToken.decrypt(e,n,i,function(e){return y(e)?void s(e,u):void(c||f)(r.decodeCharset(e,o.charset))})},envelope:function(e,n,o,c,u,a,d,p){e=r.encodeCharset(e,a.charset),"undefined"!==a.signOutputType&&1==a.signOutputType&&(o=r.encodeCharset(o,a.charset));var v=function(){t.webToken.envelope(c,n,u.cert,e,o,a,function(e){if(y(e))return void(e.code==yt.webToken.error.NOT_LOAD||e.code==yt.webToken.error.LOST_CONNECTION?g():s(e,p));var t=!0;t="undefined"!=typeof a.signOutputType&&1==a.signOutputType?r.decodeCharset(e,a.charset):r.encodeBytes(e,a.encoding),(d||f)(t)})},g=function(){e=t.util.encode64(e),L.hibiscus.envelope(u.cert,n,e,a,function(e){return i(e)?("HIBISCUS"==c&&(e.code=e.error),void s(e,p)):void(d||f)(e)})};"HIBISCUS"==c?g():v()},deenvelope:function(e,n,o,c,u,a,d,p,v){"undefined"!=typeof d.signInputType&&2==d.signInputType?(e=r.encodeCharset(e,d.charset),d.plainSizeLimit=10):e=r.decodeString(e,d.encoding),"undefined"!==d.signOutputType&&1==d.signOutputType&&(c=r.encodeCharset(c,d.charset));var g=function(){t.webToken.deenvelope(u,o,a.key,n,e,c,d,function(e){return y(e)?void s(e,v):void(p||f)(r.decodeCharset(e,d.charset))})},l=function(){e=t.util.encode64(e),L.hibiscus.deenvelope(a.cert,o,e,n,d,function(e){if(i(e))return"HIBISCUS"==u&&(e.code=e.error),void s(e,v);var n=t.util.decode64(e);(p||f)(r.decodeCharset(n,d.charset))})};"HIBISCUS"==u?l():g()},koscomEnvelop:function(e,n,i,o,c,u,a){c.opFlag=o,t.webToken.koscomEnvelop(e,r.encodeCharset(n,c.charset),i.replace(/\n/g,""),c,function(e){if(y(e))return void s(e,a);var t="";0==o?t=r.encodeBytes(e.envelopedData,c.encoding):(1==(1&o)&&(t=e.sessionID+"$"+r.encodeBytes(e.envelopedData,c.encoding)),16==(240&o)&&(t=t.indexOf("$envelopData=")<0?r.encodeBytes(e.envelopedData,c.encoding)+"$"+r.encodeBytes(e.sessionKey,c.encoding):r.encodeBytes(e.sessionKey,c.encoding))),(u||f)(t)})},koscomDevelop:function(e,n,i,o,c,u,a,d){u.opFlag=c,t.webToken.koscomDevelop(e,n,i,o,u,function(e){if(y(e))return void s(e,d);var t="";0==c?t=r.decodeCharset(e.developedData,u.charset):1==(1&c)&&(t+="$data="+r.decodeCharset(e.developedData,u.charset),t+="$session="+r.encodeBytes(e.sessionKey,u.encoding)),(a||f)(t)})},koscomEncryptData:function(e,n,i,o,c,u){o.opFlag=i,t.webToken.koscomEncryptData(r.encodeCharset(e,o.charset),n,o,function(e){if(y(e))return void s(e,u);var t="";0==i?t=r.encodeBytes(e.encryptData,o.encoding):1==(1&i)&&(t=e.sessionID+"$"+r.encodeBytes(e.encryptData,o.encoding)),(c||f)(t)})},koscomDecryptData:function(e,n,i,o,c,u){o.opFlag=i,t.webToken.koscomDecryptData(e,n,o,function(e){if(y(e))return void s(e,u);var t=r.decodeCharset(e.decryptData,o.charset);(c||f)(t)})},relayRaonGetRefNum:function(e,n,i,r,o){t.webToken.relayRaonGetRefNum(e,n,i,function(e){return y(e)?void s(e,o):void(r||f)(e.refNum)})},relayRaonGetCert:function(e,n,i,r,o,c){t.webToken.relayRaonGetCert(e,n,i,r,function(e){return y(e)?void s(e,c):void(o||f)(!0)})},relayRaonExportCert:function(e,n,i,r,o,c,u){var a,d;n.kmCert==n.cert?(a="undefined",d="undefined",o.supportKm=0):(a=n.kmCert,d=n.kmKey,o.supportKm=1),t.webToken.relayRaonExportCert(e,n.cert,n.key,a,d,i,r,o,function(e){return y(e)?void s(e,u):void(c||f)(e)})},verifyVID:function(e,n,r,o,c,u){if(e==L.token.TYPE.HIBISCUS){var a={},d=n.cert.substr(0,n.cert.length-1);L.hibiscus.verifyVID(d,r,o,a,function(e){return i(e)?void s(e,u):void(c||f)(e)})}else t.webToken.verifyVID(e,n.cert,n.key,r,o,function(e){return y(e)?void s(e,u):void(c||f)(e)})},setLanguage:function(e){t.webToken.setLanguage(e)},setConfigFile:function(e,n,i){t.webToken.setConfigFile(e,function(e){return y(e)?void s(e,i):void(n||f)(e)})},getFilePath:function(e,n,i){t.webToken.getFilePath(e,function(e){return y(e)?void s(e,i):void(n||f)({str:r.decodeCharset(yt.util.decode64(e.path),"utf-8"),path:e.path})})},setPFXNPKIFile:function(e,n,i,o,c,u){var a,d,p;p=o.customSID,a=ytcrypto.md.sha256.create(),a.update(p),d=a.digest(),t.webToken.setPFXNPKIFile(e,n,i,r.encodeBytes(d.data,"base64"),g(o.dn,"upper"),o.suffix,o.type,o,function(e){return y(e)?void s(e,u):void(c||f)(e.subjectDN)})},BackupSecureDiskCertificate:function(e,n,i,r,o,c,u){t.webToken.BackupSecureDiskCertificate(e,n,i.cert,i.key,r,o,function(e){return y(e)?void s(e,u):void(c||f)(!0)})},RestoreSecureDiskCertificate:function(e,n,i,r,o,c,u){t.webToken.RestoreSecureDiskCertificate(e,n,i.cert,i.key,r,o,function(e){return y(e)?void s(e,u):void(c||f)(!0)})},getTokenType:function(e){return"undefined"==typeof e.tokenType?void 0:"DISK DRIVE"===e.tokenType&&e.systemDrive?L.token.TYPE.SYSTEM:"DISK DRIVE"!==e.tokenType||e.systemDrive?"PKCS#11 TOKEN"===e.tokenType||"HARDWARE TOKEN"===e.tokenType?L.token.TYPE.TOKEN:"Ubikey"===e.tokenType?L.token.TYPE.UBIKEY:"SmartCard TOKEN"===e.tokenType?L.token.TYPE.SAVETOKEN:"USBKey TOKEN"===e.tokenType?L.token.TYPE.USBKEY:void 0:L.token.TYPE.LOCALDISK},CheckComplexPin:function(e,n,i,r,o,c){var u=[];"undefined"!=typeof e&&u.push(e),"undefined"!=typeof n&&u.push(n),"undefined"!=typeof i&&u.push(i),t.webToken.CheckComplexPin(u,r,function(e){return y(e)?void s(e,c):void(o||f)(!0)})},getSmartCardList:function(e,n,i,o){var c,u;c=ytcrypto.md.sha256.create(),c.update(e),u=c.digest(),t.webToken.GetSmartCardList(r.encodeBytes(u.data,"base64"),n,function(e){return y(e)?void s(e,o):void(i||f)(e)})},certificateSynchronize:function(e,n,i,r,o,c,u){t.webToken.CertificateSynchronize(e,n.key,i,r,o,function(e){return y(e)?void s(e,u):void(c||f)(!0)})},getHSMList:function(e,n,i,o){var c,u;c=ytcrypto.md.sha256.create(),c.update(e),u=c.digest(),t.webToken.GetHSMList(r.encodeBytes(u.data,"base64"),n,function(e){if(y(e))return void s(e,o);for(var n=[],r=0;r<e.length;r++)n[r]={name:e[r].name,path:t.util.decode64(e[r].path),tokenIdentifier:e[r].tokenIdentifier};(i||f)(n)})},setHSM:function(e,n,i,r){t.webToken.SetHSM(e,n,function(e){return y(e)?void s(e,r):void(i||f)(!0)})},generateFileSignature:function(e,n,i,o,c,u,a,d,p){if(a.outToFile=1==c||"1"==c?"1":"0",a.mode=1==u||"1"==u?"1":"0",a.customStr){var v,g;v=ytcrypto.md.sha256.create(),v.update(a.customStr),g=v.digest(),a.customSID=r.encodeBytes(g.data,"base64")}t.webToken.GenerateFileSignature(e,n,i.cert,i.key,r.encodeCharset(o,"utf-8"),a,function(e){if(y(e))return void s(e,p);var n="";n="0"==c&&"0"==u?r.encodeBytes(t.util.decode64(e.signature),a.encoding):"0"==c&&"1"==u?"$DN="+t.util.decodeUTF8(t.util.decode64(e.dn))+"$Data="+r.encodeBytes(t.util.decode64(e.signature),a.encoding):"1"==c&&"0"==u?t.util.decodeUTF8(t.util.decode64(e.signature)):"1"==c&&"1"==u?"$DN="+t.util.decodeUTF8(t.util.decode64(e.dn))+"$file="+t.util.decodeUTF8(t.util.decode64(e.signature)):e,(d||f)(n)})},verifyFileSignature:function(e,n,i,o,c,u){var a="";1==e?a=r.encodeBytes(r.encodeCharset(n,"utf-8"),"base64"):0==e&&(a=n),t.webToken.VerifyFileSignature(e,a,i,function(e){return y(e)?void s(e,u):void(c||f)(t.util.decodeUTF8(t.util.decode64(e.path)))})},CloseSessionAndLogoutWithP11:function(e,n){t.webToken.CloseSessionAndLogoutWithP11(function(t){return y(t)?void s(t,n):void(e||f)(!0)})},KoscomFileEnvelop:function(e,n,i,r,o){t.webToken.KoscomFileEnvelop(e,n,i,function(e){return y(e)?void s(e,o):void(r||f)(!0)})},KoscomFileDevelop:function(e,i,r,o,c,u,a){t.webToken.KoscomFileDevelop(e,i,r.key,o,n,function(e){return y(e)?void s(e,a):void(u||f)(!0)})},GetCertificateListWithDN:function(e,i,r,o){t.webToken.GetCertificateListWithDN(e,n,function(e){return y(e)?void s(e,o):void(r||f)(e)})},openCertSync:function(e,t,n,r){var c=[];L.hibiscus.openCertSync(e,{mode:t},function(e){return i(e)?void s(e,r):(d(e.localCertInfos,function(e){if("SAVE"==e.status){var t=e.subject;e.subject=decodeURIComponent(escape(yt.util.decode64(t)));var n=new o.OpenCert(e);n.setIdentifier({cert:t+5,key:t+6,kmCert:t+5,kmKey:t+6,fp:e.fingerprint}),c.push(n)}}),void(n||f)(c))})},openCertGetP12:function(e,t,n,r,o){L.hibiscus.openCertGetP12(e,t,Y.yessign.serverNonce,n,function(e){return i(e)?void s(e,o):void(r||f)(e)})},openCertSetP12:function(e,t,r,o,c){var u=r.timeStamp!==n?r.timeStamp:"undefined";L.hibiscus.openCertSetP12(L.signHelper.decodeString(e,r.encoding),t,{timeStamp:u,mode:"window"},function(e){return i(e)?void s(e,c):void(o||f)(e)})},openCertSetCertificate:function(e,t,r,o,c,u){var a=o.timeStamp!==n?o.timeStamp:"undefined";"hibiscus"!=e&&"HIBISCUS"!=e||L.hibiscus.openCertSetCertificate(yt.util.decode64(t.cert),yt.util.decode64(t.key),r,{timeStamp:a,mode:"window"},function(e){return i(e)?void s(e,u):void(c||f)(e)})},openCertRemoveP12:function(e,t,n,r){L.hibiscus.openCertRemoveP12(e,{mode:"window"},function(e){return i(e)?void s(e,r):void(n||f)(e)})},openCertSetEvent:function(e,t,n){L.hibiscus.openCertSetEvent(e,function(e){return i(e)?void s(e,n):void(t||f)(e)})},getCertInfos:function(e,t,n){L.hibiscus.getCertInfos(e,function(e){return i(e)?void s(e,n):void(t||f)(e.localCertInfos)})},openCertGetFP:function(e,t,n,r){var o=e.cert.substr(0,e.cert.length-1);L.hibiscus.openCertGetFP(o,t,function(e){return i(e)?void s(e,r):void(n||f)(e.fp)})},openCertVerifyVID:function(e,t,n,r,o,c){var u=e.cert.substr(0,e.cert.length-1);L.hibiscus.openCertVerifyVID(u,t,n,r,function(e){return i(e)?void s(e,c):void(o||f)(e)})}}}(yt,G,X,Y);D(L,{version:U,init:r,setPort:c,forEach:d,isUndefined:y,isDefined:p,isObject:v,isString:g,isNumber:l,isDate:h,isArray:M,isFunction:m,isRegExp:C,isWindow:S,isFile:b,isBlob:T,isBoolean:k,trim:j,toJson:B,fromJson:w,isSSL:E,browser:_,os:$,getHash:P,error:O,noop:f,extend:D,signHelper:G,encryptSEED:x,vestKDF:K,arrayBufferToData:A,openCertInit:o,pki:X,token:W})}(window,yt),"undefined"!=typeof secureCertificateStorage&&(vest.secureCertificateStorage=secureCertificateStorage),"undefined"!=typeof Sloth&&(vest.sloth=Sloth),"undefined"!=typeof hibiscus&&(vest.hibiscus=hibiscus),window.vest=vest;