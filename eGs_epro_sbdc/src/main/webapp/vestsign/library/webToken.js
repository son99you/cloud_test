//version: 3.1.8_e54ce34761bf3c9776b1c6dd23fc7a4531eaad89
//update: Thu Jan 16 10:11:57 2020 +0900

!function(e){function t(t){function n(e){var n,i,o,d,f,p,c;return n=ytcrypto.md.sha256.create(),n.update(r.hexToBytes(a.sessionID)),o=n.digest(),f=o.data.slice(0,16),i=ytcrypto.md.sha256.create(),i.update(o.data),d=i.digest(),p=d.data.slice(0,16),c=ytcrypto.seed.createEncryptionCipher(p,"CBC"),c.start(f),c.update(t.util.createBuffer(e)),c.finish(),r.bytesToHex(c.output.getBytes())}function i(){return a.replayAttack?n(a.messageNumber+""):a.messageNumber}function o(){var t,n,i;return t=new Date,n=ytcrypto.md.sha256.create(),n.update(t+""),i=n.digest(),e.util.bytesToHex(i.data)}var r=t.util||{},a=t.webToken=t.webToken||{};a.serviceIP="https://127.0.0.1",a.servicePort=14461,a.language="kor",a.error={},a.error.NOT_LOAD=89496682,a.error.LOST_CONNECTION=33434461,a.FS=!1,a.status="not working",a.serverID="fjewlqljw",a.FSServerID="fstinelp76",a.FSFormID="ngjsp77q4",a.sessionID=""+o(),a.messageNumber=0,a.SecKeyVendor="",a.callbackPool={};var d=function(e){if("object"==typeof f&&null!=f)return void f(e);var n,i,o;if(a.FS===!0||void 0===window.postMessage){var d;d=document.getElementById(a.FSServerID),d&&d.parentNode.removeChild(d),d=document.getElementById(a.FSFormID),d&&d.parentNode.removeChild(d)}try{if("undefined"!=typeof e.origin){if(e.origin!=a.serviceIP+":"+a.servicePort)return!1;n=JSON.parse(e.data)}else n=JSON.parse(e.data)}catch(p){throw"JSON.parse failed "+p+"\n"+e.data}if(n.resultCode==a.error.LOST_CONNECTION&&(a.status="unloaded"),o=a.callbackPool[n.messageNumber],"undefined"==typeof o)return void(console&&console.log("invalid webtoken response message"));if(delete a.callbackPool[n.messageNumber],0==n.resultCode)switch(n.operation){case"GetVersion":i=n.list;break;case"GetTokenList":i=n.list;break;case"GetCertificateList":i=n.list;break;case"GetBackupedCertificateList":i=n.list;break;case"GetCertificate":var c;return c=r.decode64(n.certificate),void t.pki.Certificate.fromBytes(c,function(e){var t={};t.cert=e,"undefined"!=typeof n.path&&(t.path=n.path),o(t)});case"GetCACertificate":i=n;break;case"GenerateSignature":if(i={},"undefined"!=typeof n.signature)if("[object Array]"===Object.prototype.toString.call(n.signature)){for(i.signature=[];n.signature.length>0;)i.signature.push(r.decode64(n.signature.shift()))}else i.signature=r.decode64(n.signature);else i=n;"undefined"!=typeof n.encryptedVIDRandom&&(i.encryptedVIDRandom=r.decode64(n.encryptedVIDRandom)),"undefined"!=typeof n.dn&&(i.dn=r.decode64(n.dn)),"undefined"!=typeof n.r&&(i.r=r.decode64(n.r)),"undefined"!=typeof n.certificate&&(i.certificate=r.decode64(n.certificate)),"undefined"!=typeof n.usimCert&&(i.usimCert=n.usimCert);break;case"VerifySignature":i=n;break;case"GenerateKeyPair":i={},i.publicKey=r.decode64(n.publicKey),i.keyIdentifier=n.keyIdentifier;break;case"PushCertificate":i=n;break;case"DeleteCertificate":i=n;break;case"EncryptVIDRandom":i={},i.encryptedVIDRandom=r.decode64(n.encryptedVIDRandom);break;case"SetTokenOptions":i=n;break;case"IssueCertificate":i=n;break;case"UpdateCertificate":i=n;break;case"RevokeCertificate":i=n;break;case"RecoverCertificate":i=n;break;case"GetPCIdentityInfo":i=n;break;case"GetMacAddress":i=n;break;case"ChangePin":i=n;break;case"VerifyPin":i=n;break;case"VerifyVID":i=n;break;case"ImportCertificate":i=n;break;case"ExportCertificate":i=n;break;case"ChangeStorage":i=n;break;case"ValidateCertificate":i=n;break;case"SetMatchedContext":i={},i.hasSession=n.hasSession,i.hasSessionPin=n.hasSessionPin,i.list=n.list;break;case"UnsetMatchedContext":i=n;break;case"MakeCustomSession":i=n;break;case"OperateTray":i=n;break;case"GetE2EInfo":i=n;break;case"GetHash":i=n;break;case"Encrypt":i=r.decode64(n.encResult);break;case"Decrypt":i=r.decode64(n.decResult);break;case"Envelope":i="undefined"!=typeof n.envelopeResult?r.decode64(n.envelopeResult):"undefined"!=typeof n.file?r.decode64(n.file):"";break;case"Deenvelope":i="undefined"!=typeof n.deenvelopeResult?r.decode64(n.deenvelopeResult):"undefined"!=typeof n.file?r.decode64(n.file):"";break;case"KoscomEnvelop":i={},"undefined"!=typeof n.envelopedData&&(i.envelopedData=r.decode64(n.envelopedData)),"undefined"!=typeof n.session&&("undefined"!=typeof n.session.id&&(i.sessionID=n.session.id),"undefined"!=typeof n.session.key&&(i.sessionKey=r.decode64(n.session.key)));break;case"KoscomDevelop":i={},"undefined"!=typeof n.developedData&&(i.developedData=r.decode64(n.developedData)),"undefined"!=typeof n.session&&("undefined"!=typeof n.session.id&&(i.sessionID=n.session.id),"undefined"!=typeof n.session.key&&(i.sessionKey=r.decode64(n.session.key)));break;case"KoscomEncryptData":i={},"undefined"!=typeof n.encryptData&&(i.encryptData=r.decode64(n.encryptData)),"undefined"!=typeof n.session&&"undefined"!=typeof n.session.id&&(i.sessionID=n.session.id);break;case"KoscomDecryptData":i={},"undefined"!=typeof n.decryptData&&(i.decryptData=r.decode64(n.decryptData));break;case"SetLocale":i=n;break;case"Relay.Raon.GetRefNum":i=n;break;case"Relay.Raon.GetCert":i=n;break;case"Relay.Raon.ExportCert":i=n;break;case"SetConfigFile":i=n;break;case"GetFilePath":i=n;break;case"SetPFXNPKIFile":i=n;break;case"BackupSecureDiskCertificate":i=n;break;case"RestoreSecureDiskCertificate":i=n;break;case"CheckComplexPin":i=n;break;case"GetBackupedTokenList":i=n.list;break;case"GetSmartCardList":i=n.list;break;case"CertificateSynchronize":i=n;break;case"GetHSMList":i=n.list;break;case"SetHSM":i=n;break;case"GenerateFileSignature":i=n;break;case"VerifyFileSignature":i=n;break;case"CloseSessionAndLogoutWithP11":i=n;break;case"KoscomFileEnvelop":i=n;break;case"KoscomFileDevelop":i=n;break;case"GetCertificateListWithDN":i=n.list;break;default:i=new t.error("not supported operation:"+n.operation)}else i=new t.error(n.resultCode,n.resultMessage);o(i)};a.callRPC=function(e,n,o){var f,p;a.load(function(c){function s(e){var n,i,o={};n=document.getElementById(a.FSServerID);try{i=n.contentWindow.name}catch(f){throw f}try{o.data=r.decodeUTF8(r.decode64(i))}catch(p){return void t.console.log(i)}d(o)}if(!c)return void n(new t.error(a.error.NOT_LOAD,"webtoken was not loaded"));e.language=a.language,e.sessionID=a.sessionID,e.messageNumber=i(),e.SecKeyVendor=a.SecKeyVendor,e.manager=o,a.messageNumber++,a.callbackPool[e.messageNumber]=n,f=document.getElementById(a.serverID);var u;u=JSON.stringify(e);var l=a.serviceIP+":"+a.servicePort,y=l+"/TIC";if(p="undefined"==typeof o?l+"/VestCert/MangoFS.jsp":l+"/VestCert/"+o+"/MangoFS.jsp",a.FS===!0||"undefined"==typeof window.postMessage){var C,g,k,v,m;if(navigator.userAgent.indexOf("MSIE 7.0")!=-1){var I="";I+="<iframe ",I+='id="'+a.FSServerID+'"',I+='name="'+a.FSServerID+'"',I+='src="'+y+'"',I+=" />",C=document.createElement(I),I="<form ",I+='id="'+a.FSFormID+'" ',I+='action="'+p+'" ',I+='method="post"',I+='target="'+a.FSServerID+'"',I+=" >",I+="</form>",g=document.createElement(I)}else C=document.createElement("iframe"),C.setAttribute("id",a.FSServerID),C.setAttribute("name",a.FSServerID),C.setAttribute("src",y),g=document.createElement("form"),g.setAttribute("id",a.FSFormID),g.setAttribute("action",p),g.setAttribute("method","post"),g.setAttribute("target",a.FSServerID);C.style.display="none",t.common.addEvent(C,"load",s),document.body.appendChild(C),g.style.display="none",document.body.appendChild(g),k=document.createElement("input"),k.setAttribute("name","message"),k.value=r.bytesToHex(r.encodeUTF8(u)),v=document.createElement("input"),v.setAttribute("name","returnURL"),m=location.href,v.value=r.bytesToHex(r.encodeUTF8(m)),g.appendChild(k),g.appendChild(v),g.submit()}else f.contentWindow.postMessage(u,a.serviceIP+":"+a.servicePort)})},a.setLanguage=function(e){a.language=e},a.getVersion=function(e,t){var n={};n.operation="GetVersion","string"==typeof moduleNames&&(n.module=e),a.callRPC(n,t)},a.getTokenList=function(e,t){var n={};n.operation="GetTokenList","undefined"!=typeof e&&"undefined"!=typeof e.reload&&(n.reload=e.reload),a.callRPC(n,t)},a.getCertificateList=function(e,t,n,i,o){var r={};r.operation="GetCertificateList",r.tokenIdentifier=e,"undefined"!=typeof t&&(r.tokenPin=t),"undefined"!=typeof n&&(r.filter=n),"undefined"!=typeof i&&(r.options=i),a.callRPC(r,o)},a.getBackupedCertificateList=function(e,t,n,i,o){var r={};r.operation="GetBackupedCertificateList",r.SecureTokenIdentifier=e,"undefined"!=typeof t&&(r.tokenPin=t),"undefined"!=typeof n&&(r.filter=n),"undefined"!=typeof i&&(r.options=i),a.callRPC(r,o,"Manager")},a.getCertificate=function(e,t,n){var i={};i.operation="GetCertificate",i.tokenIdentifier=e,i.certIdentifier=t,a.callRPC(i,n)},a.getCACertificate=function(e,t,n){var i={};i.operation="GetCACertificate",i.tokenIdentifier=e,i.certIdentifier=t,a.callRPC(i,n)},a.generateSignature=function(e,t,n,i,o,d,f,p){var c={};if(c.operation="GenerateSignature",c.tokenIdentifier=e,"undefined"!=typeof t&&(c.pin=t),"undefined"!=typeof n&&(c.certIdentifier=n),"undefined"!=typeof i&&(c.keyIdentifier=i),"[object Array]"===Object.prototype.toString.call(o)){for(c.plain=[];o.length>0;)c.plain.push(r.encode64(o.shift()))}else c.plain=r.encode64(o);"undefined"!=typeof d&&(c.outputfile=r.encode64(d)),"undefined"!=typeof f&&(c.options=f),a.callRPC(c,p)},a.generateSignatureFromKoscom=function(e,t,n,i,o,d,f){var p={};if(p.operation="GenerateSignature",p.tokenIdentifier=e,"undefined"!=typeof t&&(p.pin=t),"undefined"!=typeof n&&(p.certIdentifier=n),"undefined"!=typeof i&&(p.keyIdentifier=i),"[object Array]"===Object.prototype.toString.call(o)){for(p.plain=[];o.length>0;)p.plain.push(r.encode64(o.shift()))}else p.plain=r.encode64(o);"undefined"!=typeof d&&(p.options=d),a.callRPC(p,f)},a.verifySignature=function(e,t,n,i,o){var d={};if(d.operation="VerifySignature","[object Array]"===Object.prototype.toString.call(e)){for(d.signature=[];e.length>0;)d.signature.push(r.encode64(e.shift()))}else d.signature=r.encode64(e);if("undefined"!=typeof n){if(d.params=n,"undefined"!=typeof n.plain)if("[object Array]"===Object.prototype.toString.call(n.plain))for(d.params.plain=[];n.plain.length>0;)d.params.plain.push(r.encode64(n.plain.shift()));else d.params.plain=r.encode64(n.plain);"undefined"!=typeof n.certOrKey&&(d.params.certOrKey=r.encode64(n.certOrKey))}"undefined"!=typeof t&&(d.outputfile=r.encode64(t)),"undefined"!=typeof i&&(d.options=i),a.callRPC(d,o)},a.verifySignatureFromKoscom=function(e,t,n,i){var o={};if(o.operation="VerifySignature","string"==typeof e&&(o.signature=e),"undefined"!=typeof t&&(o.params=t,"undefined"!=typeof t.plain))if("[object Array]"===Object.prototype.toString.call(t.plain))for(o.params.plain=[];t.plain.length>0;)o.params.plain.push(r.encode64(t.plain.shift()));else o.params.plain=r.encode64(t.plain);"undefined"!=typeof n&&(o.options=n),a.callRPC(o,i)},a.generateKeyPair=function(e,n,i,o,r,d){var f={};f.operation="GenerateKeyPair",f.tokenIdentifier=e,f.algorithm="RSA",f.modularLength=o,"undefined"!=typeof n&&(f.pin=n),"undefined"!=typeof r&&(f.purpose=r),a.callRPC(f,function(i){if(i instanceof t.error)return i.pushReason("webTokenRPC failed"),void d(i);var o={};ytcrypto.crypto.key.fromBytes(i.publicKey,function(r){return r instanceof t.error?(r.pushReason("instantiate publickey  from bytes failed"),void d(r)):(o.publicKey=r,o.privateKey=a.toPrivateKey(e,n,i.keyIdentifier),void d(o))})})},a.pushCertificate=function(e,t,n,i,o,d){var f={};f.operation="PushCertificate",f.tokenIdentifier=e,"undefined"!=typeof t&&(f.pin=t),"string"==typeof n?f.certificate=n:f.certificate=r.encode64(n.toAsn1().toBytes()),f.keyIdentifier=i,"undefined"!=typeof o&&(f.random=o),a.callRPC(f,d)},a.deleteCertificate=function(e,t,n,i,o,r){var d={};d.operation="DeleteCertificate","undefined"!=typeof t&&(d.pin=t),d.tokenIdentifier=e,d.certIdentifier=n,d.keyIdentifier=i,"undefined"!=typeof o&&(d.options=o),a.callRPC(d,r)},a.encryptVIDRandom=function(e,t,n,i,o){var d={};d.operation="EncryptVIDRandom","undefined"!=typeof t&&(d.pin=t),d.tokenIdentifier=e,d.keyIdentifier=n,"string"==typeof i?d.recipientCertificate=i:d.recipientCertificate=r.encode64(i.toAsn1().toBytes()),a.callRPC(d,o)},a.setTokenOptions=function(e,t,n){var i={};i.operation="SetTokenOptions",i.tokenIdentifier=e,i.options=t,a.callRPC(i,n)},a.CAType={},a.CAType.yessign="yessign",a.CAType.crossCert="crossCert",a.CAType.signKorea="signKorea",a.issueCertificate=function(e,t,n,i,o,r,d,f){var p={};p.operation="IssueCertificate",p.tokenIdentifier=e,p.CAType=t,p.referenceNumber=n,p.authenticationCode=i,"undefined"!=typeof o&&(p.newpin=o),"undefined"!=typeof r&&(p.tokenPin=r),p.options={},d&&(d.CAServiceIP&&(p.options.CAServiceIP=d.CAServiceIP),d.CAServicePort&&(p.options.CAServicePort=d.CAServicePort),d.center&&(p.options.center=d.center),d.isBill&&(p.options.isBill=d.isBill)),a.callRPC(p,f)},a.updateCertificate=function(e,t,n,i,o,r,d,f,p,c){var s={};s.operation="UpdateCertificate",s.tokenIdentifier=e,s.CAType=i,s.oldCertIdentifier=t,s.oldKeyIdentifier=n,s.options=p,"undefined"!=typeof o&&(s.oldPin=o),"undefined"!=typeof r&&(s.newpin=r),"undefined"!=typeof d&&(s.tokenPin=d),"undefined"!=typeof f&&(s.reusePin=f),a.callRPC(s,c)},a.revokeCertificate=function(e,t,n,i,o,r,d){var f={};f.operation="RevokeCertificate",f.tokenIdentifier=e,f.CAType=i,f.certIdentifier=t,f.keyIdentifier=n,"undefined"!=typeof o&&(f.pin=o),f.options=r,a.callRPC(f,d)},a.recoverCertificate=function(e,t,n,i,o,r,d){var f={};f.operation="RecoverCertificate",f.tokenIdentifier=e,f.CAType=t,f.referenceNumber=n,f.authenticationCode=i,"undefined"!=typeof o&&(f.pin=o),f.options={},r&&(r.CAServiceIP&&(f.options.CAServiceIP=r.CAServiceIP),r.CAServicePort&&(f.options.CAServicePort=r.CAServicePort),r.center&&(f.options.center=r.center)),a.callRPC(f,d)},a.setMatchedContext=function(e,t,n,i,o,r,d){var f={};f.operation="SetMatchedContext","undefined"!=typeof e&&(f.customSID=e),"undefined"!=typeof t&&(f.ICCardPin=t),"undefined"!=typeof n&&(f.dn=n),"undefined"!=typeof i&&(f.suffix=i),"undefined"!=typeof o&&(f.type=o),"undefined"!=typeof r&&(f.options=r),a.callRPC(f,d)},a.unsetMatchedContext=function(e,t){var i={};i.operation="UnsetMatchedContext","undefined"!=typeof e&&(i.customSID=e),a.replayAttack&&(i.replayAttack=n("1")),a.callRPC(i,t)},a.makeCustomSession=function(e,t,n,i,o,r){var d={};d.operation="MakeCustomSession","undefined"!=typeof e&&(d.customSID=e),"undefined"!=typeof t&&(d.tokenIdentifier=t),"undefined"!=typeof n&&(d.certIdentifier=n),"undefined"!=typeof i&&(d.keyIdentifier=i),"undefined"!=typeof o&&(d.pin=o),a.callRPC(d,r)},a.envelope=function(e,t,n,i,o,d,f){var p={};p.operation="Envelope","undefined"!=typeof e&&(p.tokenIdentifier=e),"undefined"!=typeof t&&(p.certificate=t),"undefined"!=typeof n&&(p.certIdentifier=n),"undefined"!=typeof i&&(p.plain=r.encode64(i)),"undefined"!=typeof o&&(p.outputfile=r.encode64(o)),"undefined"!=typeof d&&(p.options=d),a.callRPC(p,f)},a.deenvelope=function(e,t,n,i,o,d,f,p){var c={};c.operation="Deenvelope","undefined"!=typeof e&&(c.tokenIdentifier=e),"undefined"!=typeof n&&(c.keyIdentifier=n),"undefined"!=typeof i&&(c.pin=i),"string"==typeof o&&(c.envelopedMsg=r.encode64(o)),"undefined"!=typeof d&&(c.outputfile=r.encode64(d)),"undefined"!=typeof f&&(c.options=f),a.callRPC(c,p)},a.koscomEnvelop=function(e,t,n,i,o){var d={};d.options={},d.operation="KoscomEnvelop","string"==typeof t&&(d.plain=r.encode64(t)),"string"==typeof n&&(d.b64DerCert=n),"undefined"!=typeof i&&(d.options=i),"string"==typeof e&&(d.options.sessionID=e),a.callRPC(d,o,"Cipher")},a.koscomDevelop=function(e,t,n,i,o,r){var d={};d.operation="KoscomDevelop","string"==typeof e&&(d.envelopedData=e),"undefined"!=typeof t&&(d.tokenIdentifier=t),"undefined"!=typeof n&&(d.keyIdentifier=n),"undefined"!=typeof i&&("number"!=typeof i&&"Number"!=typeof i||(i=String(i)),d.pin=i),"undefined"!=typeof o&&(d.options=o),a.callRPC(d,r,"Cipher")},a.koscomEncryptData=function(e,t,n,i){var o={};o.operation="KoscomEncryptData","string"==typeof e&&(o.plain=r.encode64(e)),"string"==typeof t&&""!==t&&(o.sessionKey=t),"undefined"!=typeof n&&(o.options=n),a.callRPC(o,i,"Cipher")},a.koscomDecryptData=function(e,t,n,i){var o={};o.operation="KoscomDecryptData","string"==typeof e&&(o.encryptData=e),"string"==typeof t&&""!==t&&(o.sessionKey=t),"undefined"!=typeof n&&(o.options=n),a.callRPC(o,i,"Cipher")},a.getPCIdentityInfo=function(e,t,n){var i={};i.operation="GetPCIdentityInfo",i.mode=e,i.input=t,a.callRPC(i,n,"Manager")},a.getMacAddress=function(e,t){var n={};n.operation="GetMacAddress",n.mode=e,a.callRPC(n,t,"Manager")},a.changePin=function(e,t,n,i,o,r,d){var f={};f.operation="ChangePin",f.tokenIdentifier=e,f.certIdentifier=t,f.keyIdentifier=n,"undefined"!=typeof i&&(f.oldPin=i),"undefined"!=typeof o&&(f.newPin=o),"undefined"!=typeof r&&(f.options=r),a.callRPC(f,d,"Manager")},a.verifyPin=function(e,t,n,i){var o={};o.operation="VerifyPin",o.tokenIdentifier=e,o.keyIdentifier=t,"undefined"!=typeof n&&(o.pin=n),a.callRPC(o,i,"Manager")},a.verifyVID=function(e,t,n,i,o,r){var d={};d.operation="VerifyVID",d.tokenIdentifier=e,d.certIdentifier=t,d.keyIdentifier=n,d.idn=o,"undefined"!=typeof i&&(d.pin=i),a.callRPC(d,r,"Manager")},a.importCertificate=function(e,t,n,i,o,r){var d={};d.operation="ImportCertificate",d.tokenIdentifier=e,"undefined"!=typeof t&&(d.pin=t),"undefined"!=typeof n&&(d.tokenPin=n),"undefined"!=typeof i&&(d.reusePin=i),"undefined"!=typeof o&&(d.options=o,"undefined"!=typeof o.pfxCert&&(d.pfxCert=o.pfxCert),"undefined"!=typeof o.pfxCertPath&&(d.pfxCertPath=o.pfxCertPath)),a.callRPC(d,r,"Manager")},a.exportCertificate=function(e,t,n,i,o,r,d){var f={};f.operation="ExportCertificate",f.tokenIdentifier=e,f.certIdentifier=t,f.keyIdentifier=n,"undefined"!=typeof i&&(f.pin=i),"undefined"!=typeof o&&(f.reusePin=o),"undefined"!=typeof r&&(f.options=r,"undefined"!=typeof r.returnType&&(f.returnType=r.returnType)),a.callRPC(f,d,"Manager")},a.relayRaonGetRefNum=function(e,t,n,i){var o={};o.operation="Relay.Raon.GetRefNum",o.tokenIdentifier=e,o.siteCode=t,n&&(o.options={},n.relayIP&&(o.options.relayIP=n.relayIP),n.relayPort&&(o.options.relayPort=n.relayPort),n.supportKm&&(o.options.supportKm=n.supportKm)),a.callRPC(o,i,"Manager")},a.relayRaonGetCert=function(e,t,n,i,o){var r={};r.operation="Relay.Raon.GetCert",r.tokenIdentifier=e,r.siteCode=t,"undefined"!=typeof n&&(r.tokenPin=n),i&&(r.options={},i.relayIP&&(r.options.relayIP=i.relayIP),i.relayPort&&(r.options.relayPort=i.relayPort),i.supportKm&&(r.options.supportKm=i.supportKm)),a.callRPC(r,o,"Manager")},a.relayRaonExportCert=function(e,t,n,i,o,r,d,f,p){var c={};c.operation="Relay.Raon.ExportCert",c.tokenIdentifier=e,c.certIdentifier=t,c.keyIdentifier=n,c.kmCertIdentifier=i,c.kmKeyIdentifier=o,c.refNum=d,f&&(c.options={},f.relayIP&&(c.options.relayIP=f.relayIP),f.relayPort&&(c.options.relayPort=f.relayPort),f.supportKm&&(c.options.supportKm=f.supportKm),f.deleteCert&&(c.options.deleteCert=f.deleteCert)),"undefined"!=typeof r&&(c.pin=r),a.callRPC(c,p,"Manager")},a.changeStorage=function(e,t,n,i,o,r,d,f,p){var c={};c.operation="ChangeStorage",c.tokenIdentifier=e,c.newTokenIdentifier=t,c.certIdentifier=n,c.keyIdentifier=i,c.deleteCert=o,c.options=f,"undefined"!=typeof r&&(c.pin=r),"undefined"!=typeof d&&(c.tokenPin=d),a.callRPC(c,p,"Manager")},a.ValidateCertificate=function(e,t,n,i){var o={};o.operation="ValidateCertificate",o.tokenIdentifier=e,o.certIdentifier=t,"undefined"!=typeof n&&(o.mode=n),a.callRPC(o,i,"Manager")},a.operateTray=function(e,t,n,i){var o={};o.operation="OperateTray",o.vendor=e,o.operate=t,"undefined"!=typeof n&&(o.options=n),a.callRPC(o,i,"Manager")},a.getE2EInfo=function(e,t){var n={};n.operation="GetE2EInfo",n.vendor=e,a.callRPC(n,t,"Manager")},a.setLocale=function(e,t){var n={};n.operation="SetLocale",n.locale=e,a.callRPC(n,t,"Manager")},a.getHash=function(e,t,n,i){var o={};o.operation="GetHash","undefined"!=typeof e&&(o.plainType=e),"undefined"!=typeof t&&(o.plain=r.encode64(t)),"undefined"!=typeof n&&(o.mode=n),a.callRPC(o,i,"Cipher")},a.encrypt=function(e,t,n,i){var o={};o.operation="Encrypt","undefined"!=typeof e&&(o.plain=r.encode64(e)),o.args={},"undefined"!=typeof t&&("undefined"!=typeof t.algorithm&&(o.args.algorithm=t.algorithm),"undefined"!=typeof t.mode&&(o.args.mode=t.mode),"undefined"!=typeof t.padding&&(o.args.padding=t.padding)),o.keys={},"undefined"!=typeof n&&("undefined"!=typeof n.key&&(o.keys.key=r.encode64(n.key)),"undefined"!=typeof n.iv&&(o.keys.iv=r.encode64(n.iv))),a.callRPC(o,i,"Cipher")},a.decrypt=function(e,t,n,i){var o={};o.operation="Decrypt","string"==typeof e&&(o.encMsg=r.encode64(e)),o.args={},"undefined"!=typeof t&&("undefined"!=typeof t.algorithm&&(o.args.algorithm=t.algorithm),"undefined"!=typeof t.mode&&(o.args.mode=t.mode),"undefined"!=typeof t.padding&&(o.args.padding=t.padding)),o.keys={},"undefined"!=typeof n&&("undefined"!=typeof n.key&&(o.keys.key=r.encode64(n.key)),"undefined"!=typeof n.iv&&(o.keys.iv=r.encode64(n.iv))),a.callRPC(o,i,"Cipher")},a.toPrivateKey=function(e,n,i){var o;return o=new ytcrypto.crypto.key,o.tokenIdentifier=e,o.keyIdentifier=i,o.sign=function(e,i,r){a.generateSignature(o.tokenIdentifier,n,void 0,o.keyIdentifier,i,{},function(e){return e instanceof t.error?(e.pushReason("webToken generateSiganture failed"),void r(e)):void r(e.signature)})},o._export=function(){throw"not supported"},o},a.setConfigFile=function(e,t){var n={};n.operation="SetConfigFile",n.config=e,a.callRPC(n,t,"Manager")},a.getFilePath=function(e,t){var n={};n.operation="GetFilePath",n.options=e,a.callRPC(n,t,"Manager")},a.setPFXNPKIFile=function(e,t,n,i,o,r,d,f,p){var c={};c.filePath=e,c.fileType=n,c.pin=t,c.operation="SetPFXNPKIFile","undefined"!=typeof i&&(c.customSID=i),"undefined"!=typeof o&&(c.dn=o),"undefined"!=typeof r&&(c.suffix=r),"undefined"!=typeof d&&(c.type=d),"undefined"!=typeof f&&(c.options=f),a.callRPC(c,p)},a.BackupSecureDiskCertificate=function(e,t,n,i,o,r,d){var f={};f.operation="BackupSecureDiskCertificate",f.tokenIdentifier=e,f.SecureTokenIdentifier=t,f.certIdentifier=n,f.keyIdentifier=i,f.options=r,"undefined"!=typeof o&&(f.pin=o),a.callRPC(f,d,"Manager")},a.RestoreSecureDiskCertificate=function(e,t,n,i,o,r,d){var f={};f.operation="RestoreSecureDiskCertificate",f.tokenIdentifier=t,f.SecureTokenIdentifier=e,f.certIdentifier=n,f.keyIdentifier=i,f.options=r,"undefined"!=typeof o&&(f.pin=o),a.callRPC(f,d,"Manager")},a.CheckComplexPin=function(e,t,n){var i={};i.operation="CheckComplexPin","undefined"!=typeof e&&(i.pins=e),"undefined"!=typeof t&&(i.options=t),a.callRPC(i,n,"Manager")},a.getBackupedTokenList=function(e){var t={};t.operation="GetBackupedTokenList",a.callRPC(t,e,"Manager")},a.GetSmartCardList=function(e,t,n){var i={};i.operation="GetSmartCardList","undefined"!=typeof e&&(i.customSID=e),a.callRPC(i,n)},a.CertificateSynchronize=function(e,t,n,i,o,r){var d={};d.operation="CertificateSynchronize",d.tokenIdentifier=e,d.keyIdentifier=t,"undefined"!=typeof n&&(d.newPin=n),"undefined"!=typeof i&&(d.oldPin=i),a.callRPC(d,r,"Manager")},a.GetHSMList=function(e,t,n){var i={};i.operation="GetHSMList","undefined"!=typeof e&&(i.customSID=e),a.callRPC(i,n)},a.SetHSM=function(e,t,n){var i={};i.operation="SetHSM","undefined"!=typeof e&&(i.tokenIdentifier=e),a.callRPC(i,n)},a.GenerateFileSignature=function(e,t,n,i,o,d,f){var p={};p.operation="GenerateFileSignature",p.tokenIdentifier=e,"undefined"!=typeof t&&(p.pin=t),"undefined"!=typeof n&&(p.certIdentifier=n),"undefined"!=typeof i&&(p.keyIdentifier=i),"undefined"!=typeof o&&(p.plain=r.encode64(o)),"undefined"!=typeof d&&(p.options={},"undefined"!=typeof d.customSID&&(p.options.customSID=d.customSID+""),"undefined"!=typeof d.outToFile&&(p.options.signOutputType=d.outToFile+""),"undefined"!=typeof d.mode&&(p.options.signProtocol=d.mode+"")),a.callRPC(p,f)},a.VerifyFileSignature=function(e,t,n,i){var o={};o.operation="VerifyFileSignature","undefined"!=typeof e&&(o.inputType=e+""),"undefined"!=typeof t&&(o.signature=t),"undefined"!=typeof n&&(o.originPath=r.encode64(r.encodeUTF8(n))),a.callRPC(o,i)},a.CloseSessionAndLogoutWithP11=function(e){var t={};t.operation="CloseSessionAndLogoutWithP11",a.callRPC(t,e)},a.KoscomFileEnvelop=function(e,t,n,i){var o={};o.operation="KoscomFileEnvelop","undefined"!=typeof e&&(o.path=r.encode64(r.encodeUTF8(e))),"undefined"!=typeof t&&(o.certificate=t),"undefined"!=typeof n&&(o.options={},"undewfined"!=typeof n.opFlag&&(o.options.opFlag=n.opFlag),o.options.iv=r.encode64("0123456789012345")),a.callRPC(o,i,"Cipher")},a.KoscomFileDevelop=function(e,t,n,i,o,d){var f={};f.operation="KoscomFileDevelop",f.tokenIdentifier=t,f.keyIdentifier=n,"undefined"!=typeof e&&(f.path=r.encode64(r.encodeUTF8(e))),"undefined"!=typeof o&&(f.options={}),"undefined"!=typeof i&&(f.pin=i),a.callRPC(f,d,"Cipher")},a.GetCertificateListWithDN=function(e,t,n){var i={};i.operation="GetCertificateListWithDN","undefined"!=typeof e&&(i.dn=r.encode64(r.encodeUTF8(e))),"undefined"!=typeof t&&(i.options={}),a.callRPC(i,n)},a.unLoad=function(){var e;"ready"===a.status&&(e=document.getElementById(a.serverID),"undefined"!=typeof e&&(e.parentNode.removeChild(e),a.status="not working"))},a.load=function(e){function n(n){e?e(!1):t.console.log("img load fail")}if("ready"===a.status)return void(e&&e(!0));t.console.log("try load");var i,o,r,d,f;r=a.servicePort,d=a.serviceIP+":"+r+"/",f=a.serviceIP+":"+r+"/TIC",f+="?"+(new Date).getTime(),i=document.createElement("iframe"),i.id=a.serverID;var p=function(t){a.status="ready",e&&e(!0)};t.common.addEvent(i,"load",p),i.style.display="none",i.src=d,o=document.createElement("img"),t.common.addEvent(o,"error",n);var c=function(e){delete o,document.body.appendChild(i),a.status="loading"};t.common.addEvent(o,"load",c),o.src=f};var f=window.onmessage;window.addEventListener?window.addEventListener("message",d,!1):window.attachEvent?window.attachEvent("onmessage",d):(window.onmessage=d,t.console.log("unknown addevent method"))}return t(e)}(yt);