function uploadAjaxOnprogressStart(a,d){KEDITORTOP.G_CURRKEDITOR.xhr_onprogress=new XMLHttpRequest;var b=KEDITORTOP.G_CURRKEDITOR.xhr_onprogress;b.upload.onprogress=function(a){try{var b=KEDITORTOP.RAONKEDITOR.util.parseIntOr0(a.loaded/a.total*100),c=document.getElementById("keditor_loading");c&&c.childNodes&&(c.childNodes[1].nodeValue=" Uploading... "+b+"%")}catch(d){loading_image_show(!1)}};b.onload=function(){if(b){var a;200==b.status?(a=b.responseText,a=KEDITORTOP.RAONKEDITOR.util.parseDataFromServer(a),
0==a.indexOf("[OK]")?(a=a.replace("[OK]",""),a=KEDITORTOP.RAONKEDITOR.util.makeDecryptReponseMessage(a)):0==a.indexOf("[FAIL]")&&(a=a.replace("[FAIL]",""),a=KEDITORTOP.RAONKEDITOR.util.makeDecryptReponseMessage(a))):a="[FAIL]File Upload Error";b=null;loading_image_show(!1);d(a)}};b.onerror=function(){b=null;loading_image_show(!1);d("[FAIL]File Upload Error")};var c=new FormData;a.formData&&0<a.formData.length&&a.formData.each(function(a,b){c.append(a,b)});a.fileObj&&c.append(a.fileID,a.fileObj[0]);
b.open("POST",a.handlerUrl,!0);b.send(c)}function uploadAjaxOnprogressCancel(){if(KEDITORTOP.G_CURRKEDITOR.xhr_onprogress)try{KEDITORTOP.G_CURRKEDITOR.xhr_onprogress.abort(),KEDITORTOP.G_CURRKEDITOR.xhr_onprogress=null}catch(a){}}
function setDragAndDropEvent(a){a=document.getElementById(a);KEDITORTOP.RAONKEDITOR.util.addEvent(a,"dragenter",upload_DragEnter);KEDITORTOP.RAONKEDITOR.util.addEvent(a,"dragover",upload_DragOver);KEDITORTOP.RAONKEDITOR.util.addEvent(a,"drop",upload_Drop);KEDITORTOP.RAONKEDITOR.util.addEvent(a,"click",upload_Drop_zone_click);KEDITORTOP.RAONKEDITOR.util.addEvent(a,"dragleave",upload_DragLeave)}
function upload_DragEnter(a){"1"==KEDITORTOP.G_CURRKEDITOR._config.useKManager&&useManagerDropZone(a);try{a.stopPropagation(),a.preventDefault()}catch(d){KEDITORTOP.RAONKEDITOR.util.cancelEvent(a)}}
function upload_DragOver(a){"0"==KEDITORTOP.G_CURRKEDITOR._config.useKManager&&(document.getElementById("drop_zone").style.border="solid 1px gray",document.getElementById("drop_zone").style.backgroundColor="#EDEDED");try{a.stopPropagation(),a.preventDefault()}catch(d){KEDITORTOP.RAONKEDITOR.util.cancelEvent(a)}}
function upload_DragLeave(a){"0"==KEDITORTOP.G_CURRKEDITOR._config.useKManager&&(document.getElementById("drop_zone").style.border="dashed 1px gray",document.getElementById("drop_zone").style.backgroundColor="#FFFFFF");try{a.stopPropagation(),a.preventDefault()}catch(d){KEDITORTOP.RAONKEDITOR.util.cancelEvent(a)}}
function upload_Drop(a){if("0"==KEDITORTOP.G_CURRKEDITOR._config.useKManager){document.getElementById("drop_zone").style.border="dashed 1px gray";document.getElementById("drop_zone").style.backgroundColor="#FFFFFF";var d=document.getElementById("drop_zone_uploadtype").value;G_dragDropFileObj=a.dataTransfer.files;fileOnchange(G_dragDropFileObj,d);switch(d){default:document.getElementById("file_text").value=a.dataTransfer.files[0].name,document.getElementById("file_text").setAttribute("value",a.dataTransfer.files[0].name)}}KEDITORTOP.RAONKEDITOR.util.cancelEvent(a)}
function upload_Drop_zone_click(){if("1"==KEDITORTOP.G_CURRKEDITOR._config.useKManager){var a=document.getElementById("drop_zone_uploadtype").value,d=null;switch(a){case "image":case "input_image":d=1;"1"==KEDITORTOP.G_CURRKEDITOR._config.insertMultiImage&&"image"==a&&null==elemModify&&(d=0);d={agentCmd:"KC01",maxTotalCount:d,maxOneFileSize:0,limitOrAllow:0,limitOrAllowExt:"",getSize:1,callBack:function(b){"image"==a&&(g_curr_width=[],g_curr_height=[]);for(var c={files:[]},d=b.length,e=0;e<d;e++)c.files.push({name:b[e].path.substring(b[e].path.lastIndexOf("\\")+
1),size:b[e].size,path:b[e].path,width:b[e].width,height:b[e].height}),"image"==a&&(g_curr_width.push(b[e].width),g_curr_height.push(b[e].height));fileOnchange(c,a)}};break;case "insert_file":case "hyperlink_image":case "flash":case "media":case "video_media":case "video":case "m_image":case "doc_bg_image":case "cell_bg_image":case "p_table_bg_image":case "table_bg_image":d={agentCmd:"KC01",maxTotalCount:1,maxOneFileSize:0,limitOrAllow:0,limitOrAllowExt:"",getSize:0,callBack:function(b){var c={files:[]};
c.files.push({name:b[0].path.substring(b[0].path.lastIndexOf("\\")+1),size:b[0].size,path:b[0].path});fileOnchange(c,a)}}}-1<a.indexOf("image")&&(d.filter="images|*.jpg;*.jpeg;*.png;*.gif;*.bmp;*.tif;*.tiff");LayerWin.agentFileSelect(d)}else d="Filedata",KEDITORTOP.G_CURRKEDITOR._config.fileFieldID&&(d=KEDITORTOP.G_CURRKEDITOR._config.fileFieldID),document.getElementById(d).click()}
function useManagerDropZone(a,d){var b;b=KEDITORTOP.G_CURRKEDITOR;var c=a.screenX-a.clientX,g=a.screenY-a.clientY;if("1"==b._config.useKManager){if(KEDITORTOP.RAONKEDITOR.browser.chrome||KEDITORTOP.RAONKEDITOR.browser.opera)g=window.screenY+g;window.screenX>=c?(c+=window.screenX,KEDITORTOP.RAONKEDITOR.browser.chrome&&(c+=5)):5>=window.screenX&&(KEDITORTOP.RAONKEDITOR.browser.chrome||KEDITORTOP.RAONKEDITOR.browser.opera)&&(c=window.screenX+c,KEDITORTOP.RAONKEDITOR.browser.chrome&&(c+=5));var e=null,
e=null==d||void 0==d?document.getElementById("drop_zone"):d,e=KEditorLayerWin.getClientRect(e),n=e.right-e.left,p=e.bottom-e.top;d&&(0>d.className.indexOf("raonkdropzone_over")&&(d.className=d.className.replace("raonkdropzone","raonkdropzone_over")),c+=e.left,g+=e.top);var f=[["kcmd","KC02"]];f.push(["k16",b._config.managerLang]);f.push(["k17",0]);f.push(["k40",0]);f.push(["s01",encodeURIComponent("*.*")]);var l=1;"1"==KEDITORTOP.G_CURRKEDITOR._config.insertMultiImage&&(l=0);f.push(["s02",l+""]);
f.push(["s03","0"]);f.push(["s04","0"]);f.push(["s05",0]);f.push(["s06",0]);f.push(["s07",encodeURIComponent("")]);c=c+e.left+KEDITORTOP.RAONKSolution.Agent.vertical;c+=g+e.top+KEDITORTOP.RAONKSolution.Agent.vertical;c+=n+KEDITORTOP.RAONKSolution.Agent.vertical;c+=p+KEDITORTOP.RAONKSolution.Agent.vertical;c+=b._config.dropZoneTransparency;f.push(["kp1",c]);f.push(["kp2",1]);var k=KEditorLayerWin.setManagerParam("{}",f),k=KEDITORTOP.RAONKSolution.Agent.makeEncryptManagerParam(k),m=function(a){KEDITORTOP.RAONKEDITOR.IsCreatedDropZone=
!1;d&&(d.className=d.className.substring(0,d.className.length-5));a=KEDITORTOP.RAONKSolution.Agent.parseRtn(a);var b=a.code;a=a.valueArr;if(1E3==b){for(var b={files:[]},c=document.getElementById("drop_zone_uploadtype").value,e=a.length,f=0;f<e;f++){var h=a[f].split(KEDITORTOP.RAONKSolution.Agent.formfeed),g={path:h[1],name:h[1].substring(h[1].lastIndexOf("\\")+1),size:h[2],width:0,height:0};void 0!=h[3]&&(g.width=KEDITORTOP.RAONKEDITOR.util.parseIntOr0(h[3]),g.height=KEDITORTOP.RAONKEDITOR.util.parseIntOr0(h[4]));
b.files.push(g);"image"==c&&(g_curr_width.push(g.width),g_curr_height.push(g.height))}fileOnchange(b,c)}else 2E3!=b&&2001==b&&KEditorLayerWin.sendMessageToAgent(k,m,null,!0)};KEDITORTOP.RAONKEDITOR.IsCreatedDropZone&&b.lastAgentCmd==k||(KEDITORTOP.RAONKEDITOR.IsCreatedDropZone=!0,b.lastAgentCmd=k,KEditorLayerWin.sendMessageToAgent(k,m,null,!0))}};
